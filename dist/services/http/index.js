const a47_0x22c857=a47_0x527f;(function(_0x1c8bcd,_0xd18e81){const _0x2f29e6=a47_0x527f,_0x5cc76b=_0x1c8bcd();while(!![]){try{const _0x935d96=parseInt(_0x2f29e6(0x107))/0x1*(parseInt(_0x2f29e6(0x136))/0x2)+-parseInt(_0x2f29e6(0x154))/0x3+-parseInt(_0x2f29e6(0x10b))/0x4+parseInt(_0x2f29e6(0x140))/0x5+-parseInt(_0x2f29e6(0x151))/0x6+-parseInt(_0x2f29e6(0x145))/0x7+parseInt(_0x2f29e6(0x114))/0x8;if(_0x935d96===_0xd18e81)break;else _0x5cc76b['push'](_0x5cc76b['shift']());}catch(_0x330473){_0x5cc76b['push'](_0x5cc76b['shift']());}}}(a47_0x3e24,0x62502));const axios=require(a47_0x22c857(0x131)),yaml=require(a47_0x22c857(0x128)),constants=require(a47_0x22c857(0x11c)),storage=require('../storage'),CLIENT_CREDENTIALS_TYPE='client_credentials';async function post(_0x83d297,_0x207b96,_0x392b59,_0x5adce4=a47_0x22c857(0x14f),_0x2efaa0=![]){const _0x346690=a47_0x22c857,_0x165546={'Authorization':_0x346690(0x135)+_0x83d297[_0x346690(0x137)],'Content-Type':'application/json'};_0x207b96=_0x207b96&&_0x207b96[_0x346690(0x120)]?_0x207b96[_0x346690(0x149)]('__','')+'/':'';const _0x4cd34a=_0x83d297[_0x346690(0x12f)]+_0x346690(0x129)+_0x207b96+_0x5adce4;try{return await axios[_0x346690(0x101)](_0x4cd34a,_0x392b59,{'headers':_0x165546});}catch(_0x32cc43){if(_0x32cc43?.['response']?.[_0x346690(0x119)]===0x191&&!_0x2efaa0&&_0x83d297[_0x346690(0x10f)]&&_0x83d297[_0x346690(0x13d)])return _0x83d297[_0x346690(0x137)]=await refreshToken(_0x83d297),await post(_0x83d297,_0x207b96,_0x392b59,_0x5adce4,!![]);throw getErrorMessage(_0x32cc43);}}function getErrorMessage(_0x361533){const _0x374efc=a47_0x22c857,_0x28e0cc=_0x361533?.['response']?.['data'];if(_0x28e0cc){if(typeof _0x28e0cc===_0x374efc(0x138))return _0x28e0cc;if(_0x28e0cc[_0x374efc(0x14a)])return _0x28e0cc['message'];}if(_0x361533?.[_0x374efc(0x14a)])return _0x361533[_0x374efc(0x14a)];return'Unknown\x20error:\x20'+_0x361533;}async function refreshToken({instanceUrl:_0x372aef,clientId:_0x211cb2,clientSecret:_0x2b08dc}){const _0x59a4df=a47_0x22c857,{data:_0x559cd9}=await axios[_0x59a4df(0x101)](_0x372aef+_0x59a4df(0x117),null,{'params':{'grant_type':CLIENT_CREDENTIALS_TYPE,'client_id':_0x211cb2,'client_secret':_0x2b08dc}});return _0x559cd9[_0x59a4df(0x11a)];}function callUpdateInfo(_0x869efc,_0x51409d,_0x20ab0c,_0x27d994,_0x1e43a2,_0x158c1b,_0x1b89e1,_0x106515=![]){return new Promise((_0x20f6f5,_0x1d2e40)=>{const _0x3ee916=a47_0x527f;try{try{const _0x48b70a=yaml[_0x3ee916(0x11e)](_0x1e43a2);_0x48b70a[_0x3ee916(0x104)]&&(_0x106515=_0x48b70a['Errors'][_0x3ee916(0x120)]>0x0);}catch(_0x3b4a3a){}_0x1b89e1[_0x3ee916(0x146)](_0x3ee916(0x142)+_0x158c1b);const _0x1a7258={'logId':_0x51409d,'attachmentLogId':_0x27d994,'isJobCompleted':!![],'status':'Completed','isSuccess':_0x158c1b,'isError':_0x106515,'attachmentBody':_0x1e43a2+_0x3ee916(0x121)+_0x1b89e1[_0x3ee916(0x124)][_0x3ee916(0x106)]('\x0a')},_0x9d604f={'methodType':constants[_0x3ee916(0x150)],'body':JSON[_0x3ee916(0x143)](_0x1a7258)};post(_0x869efc,_0x20ab0c,_0x9d604f)[_0x3ee916(0x130)](_0x2704e8=>{const _0x523c69=_0x3ee916;_0x1b89e1[_0x523c69(0x146)](_0x523c69(0x115)+_0x158c1b),_0x20f6f5(_0x2704e8);})[_0x3ee916(0x110)](_0x39654f=>{const _0x50e7c3=_0x3ee916;_0x1b89e1[_0x50e7c3(0x146)]('Error\x20Update\x20Log\x20is\x20Success\x20=\x20'+_0x158c1b),_0x1d2e40(_0x39654f);});}catch(_0x322d03){_0x1d2e40(_0x322d03);}});}function callNextVlocityStep(_0x2167b0,_0x34763a,_0x310d2a,_0x1e01ad,_0x35a8e4,_0x51c874,_0x627073,_0x27e201){return new Promise((_0x50341b,_0xae330b)=>{const _0x201287=a47_0x527f;try{_0x27e201[_0x201287(0x146)](_0x201287(0x139));const _0x37a8c4={'pipelineId':_0x310d2a,'pipelineNumber':_0x1e01ad,'isPass':_0x51c874,'branchId':_0x627073,'pipelineKey':_0x35a8e4},_0x1d6c9a={'methodType':constants[_0x201287(0x14c)],'body':JSON[_0x201287(0x143)](_0x37a8c4)};post(_0x2167b0,_0x34763a,_0x1d6c9a)['then'](_0x97a636=>{const _0x301f97=_0x201287;_0x27e201['log'](_0x301f97(0x13f)),_0x50341b(_0x97a636);})[_0x201287(0x110)](_0x234d1b=>{const _0x48ccb1=_0x201287;_0x27e201['log'](_0x48ccb1(0x13b)),_0xae330b(_0x234d1b);});}catch(_0x4b1e5d){_0xae330b(_0x4b1e5d);}});}function callComponentList(_0x341d1f,_0x33df8e,_0x3633d6,_0x5d73e7,_0x85fcfa,_0x1cfdc6=[]){return new Promise((_0x551a91,_0x1e433f)=>{const _0x5f2602=a47_0x527f;try{_0x85fcfa[_0x5f2602(0x146)]('Start\x20Call\x20Component\x20List');const _0x2f848f={'methodType':constants[_0x5f2602(0x133)],'body':JSON[_0x5f2602(0x143)](_0x33df8e)};post(_0x341d1f,_0x3633d6,_0x2f848f)[_0x5f2602(0x130)](_0x21fb92=>{const _0x4f42b8=_0x5f2602;let {data:_0x38ac66}=_0x21fb92;_0x38ac66=JSON[_0x4f42b8(0x11d)](_0x38ac66),_0x85fcfa[_0x4f42b8(0x146)](_0x4f42b8(0x13c)+Number[_0x4f42b8(0x109)](_0x1cfdc6['length']/_0x5d73e7*0x64)[_0x4f42b8(0x126)](0x2)+'%'),_0x1cfdc6['push'](..._0x38ac66[_0x4f42b8(0x12d)]),_0x38ac66['idList']&&_0x38ac66['idList'][_0x4f42b8(0x120)]?callComponentList(_0x341d1f,_0x38ac66[_0x4f42b8(0x141)],_0x3633d6,_0x5d73e7,_0x85fcfa,_0x1cfdc6)[_0x4f42b8(0x130)](_0x177797=>_0x551a91(_0x177797))['catch'](_0x476065=>{const _0x250926=_0x4f42b8;_0x85fcfa[_0x250926(0x146)]('Error\x20Call\x20Component\x20List'),_0x1e433f(_0x476065);}):(_0x85fcfa[_0x4f42b8(0x146)](_0x4f42b8(0x11f)),_0x551a91(_0x1cfdc6));})[_0x5f2602(0x110)](_0x4a3939=>{const _0x572d29=_0x5f2602;_0x85fcfa[_0x572d29(0x146)](_0x572d29(0x12a)),_0x1e433f(_0x4a3939);});}catch(_0xbf1f35){_0x85fcfa[_0x5f2602(0x146)]('Error\x20Call\x20Component\x20List'),_0x1e433f(_0xbf1f35);}});}async function getBodyFromStream(_0x4dc7ba,_0x127bc0,_0x14f2eb){return new Promise(_0x3279fb=>{const _0x550cd9=a47_0x527f;try{const _0x279221=[];_0x4dc7ba['on'](_0x550cd9(0x14b),(_0x34a3f2,_0x40c7f1)=>{_0x279221['push'](_0x34a3f2);}),_0x4dc7ba['on'](_0x550cd9(0x116),()=>{const _0x579a38=_0x550cd9;_0x127bc0?_0x3279fb(_0x279221[_0x579a38(0x106)]('')):_0x3279fb(Buffer['concat'](_0x279221));}),_0x4dc7ba['on'](_0x550cd9(0x11b),_0x2bb62b=>{const _0x22fc49=_0x550cd9;_0x14f2eb[_0x22fc49(0x146)](_0x22fc49(0x102)+_0x2bb62b),_0x3279fb('');});}catch(_0x453f37){_0x14f2eb['log'](_0x550cd9(0x102)+_0x453f37),_0x3279fb('');}});}async function getAttachmentBody(_0x35b46b,_0x3adb9,_0x30480b,_0x59521a=!![]){const _0x53f127=a47_0x22c857,_0x3781c5=await _0x35b46b[_0x53f127(0x127)](_0x3adb9);return await getBodyFromStream(_0x3781c5,_0x59521a,_0x30480b);}function getTime(){const _0x1cc0a9=a47_0x22c857,_0x2675fe=new Date(),_0x25cb29=[_0x2675fe['getDate'](),_0x2675fe[_0x1cc0a9(0x12e)]()+0x1,_0x2675fe[_0x1cc0a9(0x111)](),_0x2675fe[_0x1cc0a9(0x123)](),_0x2675fe[_0x1cc0a9(0x10c)](),_0x2675fe[_0x1cc0a9(0x148)]()];return _0x25cb29[_0x1cc0a9(0x153)](_0x6888d7=>_0x6888d7=_0x6888d7[_0x1cc0a9(0x113)]()['replace'](/^([0-9])$/,_0x1cc0a9(0x118))),_0x25cb29[0x2]+'-'+_0x25cb29[0x1]+'-'+_0x25cb29[0x0]+'\x20'+_0x25cb29[0x3]+':'+_0x25cb29[0x4]+':'+_0x25cb29[0x5];}function callUpdateAttachmentLog(_0x2d32bb,_0x23607a,_0x2ae43e,_0x22dff6,_0x16a662){return new Promise(_0x1250ac=>{const _0x3c07dd=a47_0x527f;try{_0x22dff6[_0x3c07dd(0x146)](_0x3c07dd(0x147));const _0x59c10c=_0x2ae43e+'\x0a'+_0x22dff6['logs'][_0x3c07dd(0x106)]('\x0a');_0x22dff6[_0x3c07dd(0x124)]=[];const _0x3a7694={'Id':_0x23607a,'Body':Buffer[_0x3c07dd(0x122)](_0x59c10c)[_0x3c07dd(0x113)](_0x3c07dd(0x13e)),'ContentType':_0x3c07dd(0x108)};_0x2d32bb['updateAttachment'](_0x3a7694)[_0x3c07dd(0x130)](()=>{const _0x3e1add=_0x3c07dd;_0x22dff6['log'](_0x3e1add(0x125)),_0x1250ac(_0x16a662);})[_0x3c07dd(0x110)](_0x53d406=>{const _0x4b8195=_0x3c07dd;_0x22dff6[_0x4b8195(0x146)](_0x4b8195(0x105)+_0x53d406),_0x1250ac(_0x16a662);});}catch(_0x2f070c){_0x22dff6['log'](_0x3c07dd(0x105)+_0x2f070c),_0x1250ac(_0x16a662);}});}function updateAttachmentLog(_0x4e28ca,_0x42c0ee,_0x42e6fc,_0x51b1de,_0x42b9a0,_0x378fd9=![]){return new Promise(_0x5d504a=>{const _0x3a319e=a47_0x527f;try{_0x51b1de['log']('Start\x20Update\x20Attachment\x20Log'),Promise[_0x3a319e(0x10e)]()['then'](()=>getAttachmentBody(_0x42c0ee,_0x42e6fc,_0x51b1de))[_0x3a319e(0x130)](_0x42353e=>{const _0x2c14a4=_0x3a319e;if(_0x378fd9)return storage[_0x2c14a4(0x152)](_0x4e28ca,getTime(),_0x51b1de)[_0x2c14a4(0x130)](_0x48d851=>{const _0x3b8bbf=_0x2c14a4;try{const _0x53fe4f=yaml[_0x3b8bbf(0x11e)](_0x48d851);_0x53fe4f['Errors'][_0x3b8bbf(0x120)]&&(_0x42b9a0=!![]);}catch(_0x56c14f){_0x48d851='',_0x42b9a0=!![];}const _0xa95757=_0x48d851+'\x0a'+_0x42353e;return callUpdateAttachmentLog(_0x42c0ee,_0x42e6fc,_0xa95757,_0x51b1de,_0x42b9a0);});return callUpdateAttachmentLog(_0x42c0ee,_0x42e6fc,_0x42353e,_0x51b1de,_0x42b9a0);})[_0x3a319e(0x130)](()=>_0x5d504a(_0x42b9a0))['catch'](()=>_0x5d504a(_0x42b9a0));}catch(_0x4f1db8){_0x51b1de['log'](_0x3a319e(0x105)+_0x4f1db8),_0x5d504a(_0x42b9a0);}});}function a47_0x527f(_0x248e1c,_0x2d43b8){const _0x3e24b6=a47_0x3e24();return a47_0x527f=function(_0x527f72,_0x464b6f){_0x527f72=_0x527f72-0x100;let _0x25cea8=_0x3e24b6[_0x527f72];return _0x25cea8;},a47_0x527f(_0x248e1c,_0x2d43b8);}function a47_0x3e24(){const _0x56c6e5=['getAttachmentBodyStream','js-yaml','/services/apexrest/','Error\x20Call\x20Component\x20List','updateMetadataLog','Is_Error__c','recordList','getMonth','instanceUrl','then','axios','End\x20Update\x20Metadata\x20Log','METHOD_TYPE_GET_ATTACHMENTS','Status__c','OAuth\x20','641194rBZmJi','accessToken','string','Start\x20Next\x20Vlocity\x20Step','\x20isSuccess\x20','Error\x20Next\x20Vlocity\x20Step','Retrieved:\x20','clientSecret','base64','End\x20Next\x20Vlocity\x20Step','1720455eWOXeG','idList','Start\x20Update\x20Log\x20is\x20Success\x20=\x20','stringify','Succeed__c','1042713hVQqvz','log','Start\x20Update\x20Attachment\x20Log','getSeconds','replace','message','data','METHOD_NEXT_VLOCITY_STEP','Exception','exports','unlocked-packages','METHOD_UPDATE_LOG','2836488uxISfR','readLogFile','forEach','1607700xSdaAQ','Completed','post','Error\x20Get\x20Attachment\x20Body\x20','Error\x20Update\x20Metadata\x20Log\x20','Errors','Error\x20Update\x20Attachment\x20Log\x20','join','1LNlDFo','text/plain','parseFloat','Partial\x20Completed','800wYJNkL','getMinutes','Start\x20Update\x20Metadata\x20Log\x20isError\x20','resolve','clientId','catch','getFullYear','Job_Completed__c','toString','7166472DXePys','End\x20Update\x20Log\x20is\x20Success\x20=\x20','end','/services/oauth2/token','0$1','status','access_token','error','../../constants','parse','load','End\x20Call\x20Component\x20List','length','Full\x20Process:\x0a\x0a','from','getHours','logs','End\x20Update\x20Attachment\x20Log','toFixed'];a47_0x3e24=function(){return _0x56c6e5;};return a47_0x3e24();}function callUpdateLog(_0x6218f7,_0x13f5ef,_0x369fb3,_0x5d2991,_0x4eeda4,_0x4229f6=![]){return new Promise((_0x8fa8cf,_0x5c3ac2)=>{const _0x1074a5=a47_0x527f;try{_0x4eeda4[_0x1074a5(0x146)](_0x1074a5(0x10d)+_0x4229f6+_0x1074a5(0x13a)+_0x5d2991);const _0x10939b=_0x5d2991&&!_0x4229f6?_0x1074a5(0x100):_0x5d2991&&_0x4229f6?_0x1074a5(0x10a):_0x1074a5(0x14d),_0x20d2f3={'Id':_0x13f5ef,[_0x369fb3+_0x1074a5(0x134)]:_0x10939b,[_0x369fb3+_0x1074a5(0x12c)]:_0x4229f6,[_0x369fb3+_0x1074a5(0x144)]:_0x5d2991,[_0x369fb3+_0x1074a5(0x112)]:!![]};_0x6218f7[_0x1074a5(0x12b)](_0x369fb3,_0x20d2f3)['then'](()=>{const _0x5c393d=_0x1074a5;_0x4eeda4[_0x5c393d(0x146)](_0x5c393d(0x132)),_0x8fa8cf(_0x20d2f3[_0x369fb3+_0x5c393d(0x12c)]);})['catch'](_0xb0f3ef=>{const _0x113dc4=_0x1074a5;_0x4eeda4['log'](_0x113dc4(0x103)+_0xb0f3ef),_0x5c3ac2(_0xb0f3ef);});}catch(_0x6036ab){_0x4eeda4[_0x1074a5(0x146)](_0x1074a5(0x103)+_0x6036ab),_0x5c3ac2(_0x6036ab);}});}module[a47_0x22c857(0x14e)]={'getTime':getTime,'refreshToken':refreshToken,'post':post,'callUpdateInfo':callUpdateInfo,'callNextVlocityStep':callNextVlocityStep,'callComponentList':callComponentList,'updateAttachmentLog':updateAttachmentLog,'getAttachmentBody':getAttachmentBody,'callUpdateAttachmentLog':callUpdateAttachmentLog,'callUpdateLog':callUpdateLog};