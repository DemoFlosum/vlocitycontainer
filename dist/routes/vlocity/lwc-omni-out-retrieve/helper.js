const a26_0xb909fb=a26_0x9edf;function a26_0x144c(){const _0x3823e7=['children','fs-extra','replace','log','1177302gsMuvJ','eleArray','Snapshot__c','FilePath','lwcComponentList','toBuffer','apex','bundleInfo','vlocity_cmt__Language__c','parse','from','then','vlocity_cmt__SubType__c','exports','/services/data/v48.0/tooling/query?q=SELECT+Id,FilePath,Format,Source+FROM+LightningComponentResource+WHERE+LightningComponentBundleId=\x27@{bundleInfo.records[0].Id}\x27','METHOD_TYPE_ADD_COMPONENTS_TO_SNAPSHOT','Process\x20Get\x20Dependency,\x20processed\x20','Start\x20Update\x20Attachment\x20Log','Start\x20Create\x20Lwc\x20Files','Start\x20Update\x20Snapshot','toString','request','Error\x20Send\x20Components\x20','addFile','End\x20Send\x20Components','Start\x20Fetch\x20OmniOut\x20Content\x20List\x20','Error\x20Get\x20Prefilled\x20JSON\x20','Process\x20Fetch\x20OmniOut\x20Content,\x20processed\x20','Error\x20Get\x20Dependency\x20List\x20','body','bundleResources','(hidden)','lwcComponentOverride','../../../constants','End\x20Update\x20Snapshot','Error\x20Query\x20','77eBXlBa','Source','push','/vlocity_cmt/v1/GenericInvoke/','stringify','records','End\x20Query','forEach','vlocity_cmt__','propSetMap','query','map','Start\x20Query','Start\x20Extract\x20LWC\x20Dependencies','GET','application/json','catch','post','2998070tfWIVe','lwc/','217WRPFIz','21380ixyQMM','entries','End\x20Create\x20Lwc\x20Files','Error\x20Update\x20Attachment\x20Log\x20','207VxfzwK','46248dpTWtt','2235585iAFTxA','36808LlnhAr','httpStatusCode','vlocity_cmt__Type__c','elementTypeToLwcTemplateMapping','Is_Error__c','Start\x20Send\x20Components','name','816002PIwjsH','resolve','LightningComponentBundle','lwcName','MAX_SIZE_UNZIP_ATTACHMENT','compositeResponse','End\x20Fetch\x20OmniOut\x20Content\x20List\x20','End\x20Extract\x20LWC\x20Dependencies','type','sobject','length','/services/data/v50.0/tooling/composite','Vlocity\x20BuildJSONWithPrefill','unlocked-packages','\x20from\x20','adm-zip','747ctiaqK','Error\x20Extract\x20LWC\x20Dependencies\x20'];a26_0x144c=function(){return _0x3823e7;};return a26_0x144c();}function a26_0x9edf(_0x58dd97,_0x2f9208){const _0x144cb6=a26_0x144c();return a26_0x9edf=function(_0x9edf64,_0xa4403b){_0x9edf64=_0x9edf64-0x76;let _0x3c5195=_0x144cb6[_0x9edf64];return _0x3c5195;},a26_0x9edf(_0x58dd97,_0x2f9208);}(function(_0x41ab5d,_0x57e5b3){const _0x1802e5=a26_0x9edf,_0x243e5b=_0x41ab5d();while(!![]){try{const _0x297a8c=-parseInt(_0x1802e5(0x87))/0x1+parseInt(_0x1802e5(0x9d))/0x2+-parseInt(_0x1802e5(0x7d))/0x3*(parseInt(_0x1802e5(0x79))/0x4)+-parseInt(_0x1802e5(0x7f))/0x5+parseInt(_0x1802e5(0x7e))/0x6*(-parseInt(_0x1802e5(0x78))/0x7)+parseInt(_0x1802e5(0x80))/0x8*(-parseInt(_0x1802e5(0x97))/0x9)+parseInt(_0x1802e5(0x76))/0xa*(parseInt(_0x1802e5(0xc1))/0xb);if(_0x297a8c===_0x57e5b3)break;else _0x243e5b['push'](_0x243e5b['shift']());}catch(_0x508539){_0x243e5b['push'](_0x243e5b['shift']());}}}(a26_0x144c,0x6a171));const path=require('path'),fs=require('fs'),fse=require(a26_0xb909fb(0x9a)),AdmZip=require(a26_0xb909fb(0x96)),constants=require(a26_0xb909fb(0xbe)),http=require('../../../services/http');function query(_0x3cfe39,_0x5c0ce7,_0x2bef90){return new Promise((_0x509c69,_0x25d181)=>{const _0x40c907=a26_0x9edf;try{_0x2bef90['log'](_0x40c907(0xcd)),_0x3cfe39[_0x40c907(0xcb)](_0x5c0ce7,(_0x50fafd,_0x5ddc20)=>{const _0x160d3a=_0x40c907;_0x50fafd?(_0x2bef90[_0x160d3a(0x9c)]('Error\x20Query\x20'+_0x50fafd),_0x25d181(_0x50fafd)):(_0x2bef90[_0x160d3a(0x9c)](_0x160d3a(0xc7)),_0x509c69(_0x5ddc20[_0x160d3a(0xc6)]['filter'](_0x2d8c2b=>_0x2d8c2b[_0x160d3a(0x82)]&&_0x2d8c2b[_0x160d3a(0xa9)]&&_0x2d8c2b[_0x160d3a(0xa5)])[_0x160d3a(0xcc)](({vlocity_cmt__Type__c:_0x36eaab,vlocity_cmt__SubType__c:_0x1de46f,vlocity_cmt__Language__c:_0x56f79b})=>{return''+_0x36eaab+_0x1de46f+_0x56f79b;})));});}catch(_0x18b85c){_0x25d181(_0x18b85c),_0x2bef90[_0x40c907(0x9c)](_0x40c907(0xc0)+_0x18b85c);}});}function fetchOmniOutContentList(_0x56c5e2,_0x44a3aa,_0x280cdc){return new Promise((_0x5bb69f,_0x5f239d)=>{const _0x379fd6=a26_0x9edf;try{_0x280cdc[_0x379fd6(0x9c)](_0x379fd6(0xb6));const _0x4e8e22=[];let _0x1e8597=0x1,_0x4418cc=Promise[_0x379fd6(0x88)]();_0x44a3aa['forEach'](_0x10470a=>{const _0x1121ff=_0x379fd6;_0x4418cc=_0x4418cc[_0x1121ff(0xa8)](()=>fetchOmniOutContent(_0x56c5e2,_0x10470a))['then'](_0x4e2d5=>{const _0x27e20b=_0x1121ff;_0x4e2d5&&_0x4e2d5[_0x27e20b(0x8c)]&&_0x4e2d5[_0x27e20b(0x8c)][_0x27e20b(0x91)]===0x2&&(_0x4e2d5[_0x27e20b(0x8c)][0x0][_0x27e20b(0x81)]===0xc8&&_0x4e8e22['push']({'lwcComponentList':_0x4e2d5['compositeResponse'][0x1][_0x27e20b(0xba)]['records'],'name':_0x4e2d5[_0x27e20b(0x8c)][0x0]['body'][_0x27e20b(0xc6)][0x0]['DeveloperName']})),_0x280cdc[_0x27e20b(0x9c)](_0x27e20b(0xb8)+_0x1e8597++ +',\x20retrieved\x20'+_0x4e8e22[_0x27e20b(0x91)]+',\x20all\x20'+_0x44a3aa[_0x27e20b(0x91)]);});}),_0x4418cc['then'](()=>{const _0xf44c93=_0x379fd6;_0x280cdc['log'](_0xf44c93(0x8d)),_0x5bb69f(_0x4e8e22);})[_0x379fd6(0xd1)](_0x5cd6f6=>{const _0x9bca7d=_0x379fd6;_0x280cdc[_0x9bca7d(0x9c)]('Error\x20Fetch\x20OmniOut\x20Content\x20List\x20'+_0x5cd6f6),_0x5f239d(_0x5cd6f6);});}catch(_0x7b54b7){_0x5f239d(_0x7b54b7),_0x280cdc['log']('Error\x20Fetch\x20OmniOut\x20Content\x20List\x20'+_0x7b54b7);}});}function fetchOmniOutContent(_0x426223,_0x2f11a7){const _0x4f8e42=a26_0xb909fb;_0x2f11a7=_0x2f11a7[_0x4f8e42(0x9b)]('-','')[_0x4f8e42(0x9b)](_0x4f8e42(0xc9),'');const _0x1bddf6={'allOrNone':!![],'compositeRequest':[{'method':'GET','referenceId':_0x4f8e42(0xa4),'url':'/services/data/v48.0/tooling/query?q=SELECT+Id,DeveloperName,Description+FROM+LightningComponentBundle+WHERE+DeveloperName=\x27'+_0x2f11a7+'\x27'},{'method':_0x4f8e42(0xcf),'referenceId':_0x4f8e42(0xbb),'url':_0x4f8e42(0xab)}]},_0x2e0421=_0x426223['instanceUrl'],_0x4f4145={'method':'POST','url':_0x2e0421+_0x4f8e42(0x92),'body':JSON[_0x4f8e42(0xc5)](_0x1bddf6),'headers':{'Content-Type':_0x4f8e42(0xd0)}};return _0x426223[_0x4f8e42(0xb2)](_0x4f4145);}function createLwcFiles(_0x370ceb,_0x2a93ab,_0x227000,_0x593653){return new Promise((_0x5a91e6,_0x2a88f7)=>{const _0x3cc60a=a26_0x9edf;try{_0x593653[_0x3cc60a(0x9c)](_0x3cc60a(0xaf));let _0x24da9e=[],_0x152a30=[],_0x48f9a7=0x0,_0x586b74=new AdmZip();_0x2a93ab['forEach'](_0x2bd3df=>{const _0x55510a=_0x3cc60a;_0x152a30[_0x55510a(0xc3)]({'apiName':_0x2bd3df[_0x55510a(0x86)],'componentType':'LightningComponentBundle','label':_0x55510a(0x77)+_0x2bd3df[_0x55510a(0x86)]}),_0x2bd3df[_0x55510a(0xa1)][_0x55510a(0xc8)](_0x5718c2=>{const _0x3d7cd3=_0x55510a;_0x5718c2[_0x3d7cd3(0xc2)]!==_0x3d7cd3(0xbc)&&(_0x48f9a7+=_0x5718c2[_0x3d7cd3(0xc2)][_0x3d7cd3(0x91)],_0x48f9a7<constants[_0x3d7cd3(0x8b)]?_0x586b74[_0x3d7cd3(0xb4)](''+_0x5718c2[_0x3d7cd3(0xa0)],Buffer[_0x3d7cd3(0xa7)](_0x5718c2[_0x3d7cd3(0xc2)][_0x3d7cd3(0x9b)](new RegExp('vlocity_cmt','g'),'c'))):(_0x24da9e[_0x3d7cd3(0xc3)]({'snapshotId':_0x227000,'typeList':[{'type':_0x3d7cd3(0x89),'zip':_0x586b74[_0x3d7cd3(0xa2)]()[_0x3d7cd3(0xb1)]('base64'),'componentList':_0x152a30}]}),_0x152a30=[],_0x48f9a7=0x0,_0x586b74=new AdmZip()));}),delete _0x2bd3df['lwcComponentList'];}),_0x152a30['length']&&_0x24da9e[_0x3cc60a(0xc3)]({'snapshotId':_0x227000,'typeList':[{'type':_0x3cc60a(0x89),'zip':_0x586b74[_0x3cc60a(0xa2)]()['toString']('base64'),'componentList':_0x152a30}]}),_0x593653[_0x3cc60a(0x9c)](_0x3cc60a(0x7b)),_0x5a91e6(_0x24da9e);}catch(_0x5bd71e){_0x593653[_0x3cc60a(0x9c)]('Error\x20Create\x20Lwc\x20Files\x20'+_0x5bd71e),_0x2a88f7(_0x5bd71e);}});}function sendComponents(_0x6ac5a2,_0x466e1e,_0x3885c5,_0x548e6f,_0x407bbd){return new Promise((_0x31cc69,_0x43027b)=>{const _0x15d975=a26_0x9edf;try{_0x407bbd[_0x15d975(0x9c)](_0x15d975(0x85));let _0x320ec5=Promise['resolve']();_0x548e6f[_0x15d975(0xc8)](_0x1f812d=>{const _0x2b0c4f=_0x15d975;_0x320ec5=_0x320ec5[_0x2b0c4f(0xa8)](()=>callSentComponents(_0x6ac5a2,_0x466e1e,_0x3885c5,_0x1f812d));}),_0x320ec5[_0x15d975(0xa8)](()=>{const _0x45ab1b=_0x15d975;_0x407bbd[_0x45ab1b(0x9c)](_0x45ab1b(0xb5)),_0x31cc69();})[_0x15d975(0xd1)](_0x1b8372=>{const _0x2c5cf3=_0x15d975;_0x407bbd[_0x2c5cf3(0x9c)](_0x2c5cf3(0xb3)+_0x1b8372),_0x43027b(_0x1b8372);});}catch(_0x21c2b3){_0x407bbd[_0x15d975(0x9c)](_0x15d975(0xb3)+_0x21c2b3),_0x43027b(_0x21c2b3);}});}function callSentComponents(_0x1464b7,_0x46cbd1,_0x328157,_0x48eb92){return new Promise((_0x163f2f,_0x21324c)=>{const _0x35fb05=a26_0x9edf;try{const _0x23555b={'methodType':constants[_0x35fb05(0xac)],'body':JSON[_0x35fb05(0xc5)](_0x48eb92)};_0x328157=_0x328157?_0x328157[_0x35fb05(0x9b)]('__','')+'/':'';const _0x56d478=_0x1464b7+'/services/apexrest/'+_0x328157['replace']('__','')+_0x35fb05(0x94);http[_0x35fb05(0xd2)](_0x56d478,_0x46cbd1,_0x328157[_0x35fb05(0x9b)]('__',''),JSON[_0x35fb05(0xc5)](_0x23555b))[_0x35fb05(0xa8)](()=>{_0x163f2f();})[_0x35fb05(0xd1)](_0x21324c);}catch(_0x428144){_0x21324c(_0x428144);}});}function completeDeployment(_0x54d7f3,_0x304aad,_0x425d72,_0x11ca6d,_0x42c3b1,_0x1fe02e,_0x5e5e73,_0x159ac6,_0x53e655=![]){return new Promise((_0x546e32,_0x1df5a3)=>{const _0x4daf76=a26_0x9edf;try{Promise[_0x4daf76(0x88)]()[_0x4daf76(0xa8)](()=>updateAttachmentLog(_0x54d7f3,_0x304aad,_0x1fe02e,_0x159ac6,_0x53e655,!![]))[_0x4daf76(0xa8)](_0x2ce502=>{return _0x53e655=_0x2ce502,http['callUpdateLog'](_0x304aad,_0x42c3b1,_0x425d72,_0x5e5e73,_0x159ac6,_0x2ce502);})['then'](()=>callUpdateSnapshot(_0x304aad,_0x11ca6d,_0x425d72,_0x53e655,_0x159ac6));}catch(_0x210652){_0x1df5a3(_0x210652);}});}function updateAttachmentLog(_0xba7b63,_0x4fc297,_0x5a9c07,_0x100487,_0x36ab3f,_0x5135c6=![]){return new Promise(_0x203329=>{const _0x30a8c7=a26_0x9edf;try{_0x100487[_0x30a8c7(0x9c)](_0x30a8c7(0xae)),Promise[_0x30a8c7(0x88)]()['then'](()=>http['getAttachmentBody'](_0x4fc297,_0x5a9c07,_0x100487))[_0x30a8c7(0xa8)](_0x2f67ef=>{return http['callUpdateAttachmentLog'](_0x4fc297,_0x5a9c07,_0x2f67ef,_0x100487,_0x36ab3f);})[_0x30a8c7(0xa8)](()=>_0x203329(_0x36ab3f))[_0x30a8c7(0xd1)](()=>_0x203329(_0x36ab3f));}catch(_0x5b5a6f){_0x100487[_0x30a8c7(0x9c)](_0x30a8c7(0x7c)+_0x5b5a6f),_0x203329(_0x36ab3f);}});}function callUpdateSnapshot(_0x4185f3,_0x289148,_0x2e98fc,_0xb6528c,_0x26b0ef){return new Promise((_0x24a992,_0x5581bf)=>{const _0x57e28a=a26_0x9edf;try{_0x26b0ef[_0x57e28a(0x9c)](_0x57e28a(0xb0));const _0x32fd12={'Id':_0x289148,[_0x2e98fc+'Is_Completed__c']:!![],[_0x2e98fc+_0x57e28a(0x84)]:_0xb6528c};_0x4185f3[_0x57e28a(0x90)](_0x2e98fc+_0x57e28a(0x9f))['update'](_0x32fd12)[_0x57e28a(0xa8)](()=>{const _0x441f49=_0x57e28a;_0x26b0ef[_0x441f49(0x9c)](_0x441f49(0xbf)),_0x24a992();})['catch'](_0x18d2f8=>{const _0x5b07b0=_0x57e28a;_0x26b0ef[_0x5b07b0(0x9c)]('Error\x20Update\x20Snapshot'),_0x5581bf(_0x18d2f8);});}catch(_0x3db1ef){_0x26b0ef[_0x57e28a(0x9c)]('Error\x20Update\x20Snapshot'),_0x5581bf(_0x3db1ef);}});}function getDependencyList(_0x33ef35,_0x18f132,_0x27ca5d){return new Promise((_0x52c693,_0x1b5905)=>{const _0x5bab8e=a26_0x9edf;try{_0x27ca5d['log']('Start\x20Get\x20Dependency\x20List\x20');const _0x3edb32=[];let _0x47c2fe=Promise[_0x5bab8e(0x88)]();_0x18f132[_0x5bab8e(0xc8)](_0x1c49e7=>{const _0x18c926=_0x5bab8e;_0x47c2fe=_0x47c2fe[_0x18c926(0xa8)](()=>getPrefilledJSON(_0x33ef35,_0x1c49e7,_0x27ca5d))[_0x18c926(0xa8)](_0x5a639b=>{const _0x305668=_0x18c926;_0x3edb32['push'](_0x5a639b),_0x27ca5d[_0x305668(0x9c)](_0x305668(0xad)+_0x3edb32[_0x305668(0x91)]+_0x305668(0x95)+_0x18f132['length']);});}),_0x47c2fe[_0x5bab8e(0xa8)](()=>{const _0x317d31=_0x5bab8e;_0x27ca5d[_0x317d31(0x9c)]('End\x20Get\x20Dependency\x20List\x20'),_0x52c693(_0x3edb32);})[_0x5bab8e(0xd1)](_0x405036=>{const _0x4f9b2a=_0x5bab8e;_0x27ca5d[_0x4f9b2a(0x9c)](_0x4f9b2a(0xb9)+_0x405036),_0x1b5905(_0x405036);});}catch(_0x120edb){_0x27ca5d[_0x5bab8e(0x9c)](_0x5bab8e(0xb9)+_0x120edb),_0x1b5905(_0x120edb);}});}function getPrefilledJSON(_0x43d21d,_0x40b99a,_0x5e192f){return new Promise((_0x41f9ba,_0x4e7c57)=>{const _0x5d0cc2=a26_0x9edf;try{const _0x50eab5={'sClassName':_0x5d0cc2(0x93),'sType':_0x40b99a[_0x5d0cc2(0x82)],'sSubType':_0x40b99a[_0x5d0cc2(0xa9)],'sLang':_0x40b99a['vlocity_cmt__Language__c']};_0x43d21d[_0x5d0cc2(0xa3)]['post'](_0x5d0cc2(0xc4),_0x50eab5,(_0x372db7,_0x55ac70)=>{const _0x46235b=_0x5d0cc2;_0x372db7?(_0x5e192f[_0x46235b(0x9c)]('Error\x20getPrefilledJSON\x20'+_0x372db7),_0x4e7c57(_0x372db7)):_0x41f9ba(JSON[_0x46235b(0xa6)](_0x55ac70));});}catch(_0x4bdf51){_0x4e7c57(_0x4bdf51),_0x5e192f[_0x5d0cc2(0x9c)](_0x5d0cc2(0xb7)+_0x4bdf51);}});}function extractLwcDependencies(_0x442325,_0x580100){return new Promise((_0x2158cb,_0x3d1a8c)=>{const _0x53752a=a26_0x9edf;try{_0x580100[_0x53752a(0x9c)](_0x53752a(0xce));let _0x4a0f31=[];_0x442325[_0x53752a(0xc8)](_0x474ff4=>{const _0x260d87=_0x53752a;_0x474ff4[_0x260d87(0x99)]&&_0x474ff4[_0x260d87(0x99)][_0x260d87(0x91)]>0x0&&_0x474ff4[_0x260d87(0x99)][_0x260d87(0xc8)](_0x2ca49f=>{const _0x26bc84=_0x260d87;_0x2ca49f['children']&&_0x2ca49f['children'][_0x26bc84(0x91)]>0x0&&_0x2ca49f[_0x26bc84(0x99)][_0x26bc84(0xc8)](_0x35e868=>{const _0x21f979=_0x26bc84;_0x35e868[_0x21f979(0x9e)][0x0][_0x21f979(0x8f)]==='Custom\x20Lightning\x20Web\x20Component'&&_0x4a0f31[_0x21f979(0xc3)](_0x35e868[_0x21f979(0x9e)][0x0][_0x21f979(0xca)][_0x21f979(0x8a)]);});});if(_0x474ff4['propSetMap']&&_0x474ff4[_0x260d87(0xca)][_0x260d87(0x83)])for(const [_0x1fccc9,_0x5ce137]of Object[_0x260d87(0x7a)](_0x474ff4[_0x260d87(0xca)]['elementTypeToLwcTemplateMapping'])){_0x4a0f31['push'](_0x5ce137);}_0x474ff4['children']&&_0x474ff4[_0x260d87(0x99)][_0x260d87(0x91)]>0x0&&_0x474ff4['children']['forEach'](_0x29166e=>{const _0x48bbb9=_0x260d87;_0x29166e[_0x48bbb9(0xca)]&&_0x29166e[_0x48bbb9(0xca)]['lwcComponentOverride']&&_0x4a0f31[_0x48bbb9(0xc3)](_0x29166e[_0x48bbb9(0xca)][_0x48bbb9(0xbd)]),_0x29166e[_0x48bbb9(0x99)]&&_0x29166e['children']['length']>0x0&&_0x29166e[_0x48bbb9(0x99)][_0x48bbb9(0xc8)](_0xff6eaf=>{const _0x561023=_0x48bbb9;_0xff6eaf[_0x561023(0x9e)][0x0][_0x561023(0xca)]&&_0xff6eaf[_0x561023(0x9e)][0x0][_0x561023(0xca)]['lwcComponentOverride']&&_0x4a0f31[_0x561023(0xc3)](_0xff6eaf[_0x561023(0x9e)][0x0][_0x561023(0xca)][_0x561023(0xbd)]);});});}),_0x580100[_0x53752a(0x9c)](_0x53752a(0x8e)),_0x2158cb(_0x4a0f31);}catch(_0x571480){_0x580100[_0x53752a(0x9c)](_0x53752a(0x98)+_0x571480),_0x3d1a8c(_0x571480);}});}module[a26_0xb909fb(0xaa)]={'query':query,'getDependencyList':getDependencyList,'extractLwcDependencies':extractLwcDependencies,'fetchOmniOutContentList':fetchOmniOutContentList,'createLwcFiles':createLwcFiles,'sendComponents':sendComponents,'completeDeployment':completeDeployment};