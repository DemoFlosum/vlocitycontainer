const a34_0x2d4d95=a34_0x3810;(function(_0x4c39bc,_0x10da71){const _0x575bc3=a34_0x3810,_0xae2aaa=_0x4c39bc();while(!![]){try{const _0x21c5bb=parseInt(_0x575bc3(0xe2))/0x1*(-parseInt(_0x575bc3(0x126))/0x2)+-parseInt(_0x575bc3(0xde))/0x3*(parseInt(_0x575bc3(0xf9))/0x4)+parseInt(_0x575bc3(0xf0))/0x5+parseInt(_0x575bc3(0xf4))/0x6*(-parseInt(_0x575bc3(0xef))/0x7)+-parseInt(_0x575bc3(0x102))/0x8*(-parseInt(_0x575bc3(0xf2))/0x9)+parseInt(_0x575bc3(0x127))/0xa*(parseInt(_0x575bc3(0xe0))/0xb)+parseInt(_0x575bc3(0x10b))/0xc;if(_0x21c5bb===_0x10da71)break;else _0xae2aaa['push'](_0xae2aaa['shift']());}catch(_0x313277){_0xae2aaa['push'](_0xae2aaa['shift']());}}}(a34_0x37a8,0x2e6bd));const path=require('path'),fs=require('fs'),fse=require('fs-extra'),AdmZip=require(a34_0x2d4d95(0x112)),constants=require('../../../constants'),http=require(a34_0x2d4d95(0xec));function query(_0x25e475,_0x2bee47,_0x2b7d2d){return new Promise((_0x3e5400,_0x3caf48)=>{const _0x519d9c=a34_0x3810;try{_0x2b7d2d[_0x519d9c(0x11f)]('Start\x20Query'),_0x25e475[_0x519d9c(0x108)](_0x2bee47,(_0x31032f,_0x1badf8)=>{const _0x4de1a0=_0x519d9c;_0x31032f?(_0x2b7d2d[_0x4de1a0(0x11f)](_0x4de1a0(0xe8)+_0x31032f),_0x3caf48(_0x31032f)):(_0x2b7d2d[_0x4de1a0(0x11f)](_0x4de1a0(0x12e)),_0x3e5400(_0x1badf8[_0x4de1a0(0x132)]['filter'](_0x50ce1c=>_0x50ce1c[_0x4de1a0(0xf3)]&&_0x50ce1c[_0x4de1a0(0xe9)]&&_0x50ce1c[_0x4de1a0(0x107)])[_0x4de1a0(0x129)](({vlocity_cmt__Type__c:_0x397240,vlocity_cmt__SubType__c:_0x41b231,vlocity_cmt__Language__c:_0x22f390})=>''+_0x397240+_0x41b231+_0x22f390)));});}catch(_0x53fa2e){_0x3caf48(_0x53fa2e),_0x2b7d2d[_0x519d9c(0x11f)]('Error\x20Query\x20'+_0x53fa2e);}});}function fetchOmniOutContentList(_0x5e8c36,_0x2df864,_0x27ec8b){return new Promise((_0x56ea55,_0x38605d)=>{const _0x53186b=a34_0x3810;try{_0x27ec8b[_0x53186b(0x11f)](_0x53186b(0x10f));const _0x2d39c5=[];let _0x52e25a=0x1,_0x350e7b=Promise['resolve']();_0x2df864[_0x53186b(0xfb)](_0x2ee5e5=>{const _0x442d47=_0x53186b;_0x350e7b=_0x350e7b[_0x442d47(0x10e)](()=>fetchOmniOutContent(_0x5e8c36,_0x2ee5e5))['then'](_0x3ce26b=>{const _0x52b4f3=_0x442d47;_0x3ce26b&&_0x3ce26b[_0x52b4f3(0xe7)]&&_0x3ce26b[_0x52b4f3(0xe7)][_0x52b4f3(0x125)]===0x2&&(_0x3ce26b[_0x52b4f3(0xe7)][0x0][_0x52b4f3(0x113)]===0xc8&&_0x2d39c5['push']({'lwcComponentList':_0x3ce26b['compositeResponse'][0x1][_0x52b4f3(0x119)][_0x52b4f3(0x132)],'name':_0x3ce26b['compositeResponse'][0x0][_0x52b4f3(0x119)][_0x52b4f3(0x132)][0x0][_0x52b4f3(0xfe)]})),_0x27ec8b[_0x52b4f3(0x11f)]('Process\x20Fetch\x20OmniOut\x20Content,\x20processed\x20'+_0x52e25a++ +_0x52b4f3(0xe3)+_0x2d39c5[_0x52b4f3(0x125)]+_0x52b4f3(0x123)+_0x2df864['length']);});}),_0x350e7b['then'](()=>{const _0x125735=_0x53186b;_0x27ec8b['log'](_0x125735(0xe5)),_0x56ea55(_0x2d39c5);})[_0x53186b(0xd8)](_0x5c856b=>{const _0x7067be=_0x53186b;_0x27ec8b['log'](_0x7067be(0xda)+_0x5c856b),_0x38605d(_0x5c856b);});}catch(_0x2e3f49){_0x38605d(_0x2e3f49),_0x27ec8b[_0x53186b(0x11f)](_0x53186b(0xda)+_0x2e3f49);}});}function fetchOmniOutContent(_0x5cbcc9,_0x31ddf5){const _0x1a7c8a=a34_0x2d4d95;_0x31ddf5=_0x31ddf5['replace']('-','')[_0x1a7c8a(0x118)](_0x1a7c8a(0xfd),'');const _0x464702={'allOrNone':!![],'compositeRequest':[{'method':_0x1a7c8a(0x10a),'referenceId':_0x1a7c8a(0x111),'url':_0x1a7c8a(0x115)+_0x31ddf5+'\x27'},{'method':_0x1a7c8a(0x10a),'referenceId':_0x1a7c8a(0x117),'url':'/services/data/v48.0/tooling/query?q=SELECT+Id,FilePath,Format,Source+FROM+LightningComponentResource+WHERE+LightningComponentBundleId=\x27@{bundleInfo.records[0].Id}\x27'}]},_0x49b744=_0x5cbcc9['instanceUrl'],_0x5c0318={'method':_0x1a7c8a(0xf7),'url':_0x49b744+'/services/data/v50.0/tooling/composite','body':JSON['stringify'](_0x464702),'headers':{'Content-Type':_0x1a7c8a(0x10d)}};return _0x5cbcc9[_0x1a7c8a(0x130)](_0x5c0318);}function createLwcFiles(_0x43e294,_0xe21bb2,_0x199d65,_0x2f2b7f){return new Promise((_0x1f43b4,_0x102152)=>{const _0x293b37=a34_0x3810;try{_0x2f2b7f['log'](_0x293b37(0x124));const _0x3463d7=[];let _0x372797=[],_0x330d1d=0x0,_0x2a4ab2=new AdmZip();_0xe21bb2[_0x293b37(0xfb)](_0x9434ab=>{const _0x24d015=_0x293b37;_0x372797[_0x24d015(0x116)]({'apiName':_0x9434ab[_0x24d015(0xf5)],'componentType':'LightningComponentBundle','label':'lwc/'+_0x9434ab['name']}),_0x9434ab['lwcComponentList'][_0x24d015(0xfb)](_0x62b14b=>{const _0x215d90=_0x24d015;_0x62b14b[_0x215d90(0xd5)]!==_0x215d90(0x12b)&&(_0x330d1d+=_0x62b14b[_0x215d90(0xd5)][_0x215d90(0x125)],_0x330d1d<constants[_0x215d90(0xff)]?_0x2a4ab2[_0x215d90(0x131)](''+_0x62b14b[_0x215d90(0xed)],Buffer[_0x215d90(0xdf)](_0x62b14b['Source']['replace'](new RegExp(_0x215d90(0xeb),'g'),'c'))):(_0x3463d7[_0x215d90(0x116)]({'snapshotId':_0x199d65,'typeList':[{'type':_0x215d90(0xf6),'zip':_0x2a4ab2[_0x215d90(0xfc)]()['toString']('base64'),'componentList':_0x372797}]}),_0x372797=[],_0x330d1d=0x0,_0x2a4ab2=new AdmZip()));}),delete _0x9434ab[_0x24d015(0x114)];}),_0x372797['length']&&_0x3463d7[_0x293b37(0x116)]({'snapshotId':_0x199d65,'typeList':[{'type':_0x293b37(0xf6),'zip':_0x2a4ab2['toBuffer']()[_0x293b37(0xe6)](_0x293b37(0x12a)),'componentList':_0x372797}]}),_0x2f2b7f['log'](_0x293b37(0x104)),_0x1f43b4(_0x3463d7);}catch(_0x33cbcb){_0x2f2b7f[_0x293b37(0x11f)](_0x293b37(0x110)+_0x33cbcb),_0x102152(_0x33cbcb);}});}function sendComponents(_0x259149,_0x20ba5f,_0x2392d0,_0x190674){return new Promise((_0x46eacc,_0x1d3c24)=>{const _0x2a2aa8=a34_0x3810;try{_0x190674[_0x2a2aa8(0x11f)]('Start\x20Send\x20Components');let _0xf723eb=Promise['resolve']();_0x2392d0[_0x2a2aa8(0xfb)](_0x190fd9=>{const _0x467dfa=_0x2a2aa8;_0xf723eb=_0xf723eb[_0x467dfa(0x10e)](()=>callSentComponents(_0x259149,_0x20ba5f,_0x190fd9));}),_0xf723eb['then'](()=>{const _0x3164a4=_0x2a2aa8;_0x190674[_0x3164a4(0x11f)]('End\x20Send\x20Components'),_0x46eacc();})['catch'](_0x1e57eb=>{const _0x1aa39f=_0x2a2aa8;_0x190674[_0x1aa39f(0x11f)](_0x1aa39f(0x121)+_0x1e57eb),_0x1d3c24(_0x1e57eb);});}catch(_0x4859f0){_0x190674[_0x2a2aa8(0x11f)](_0x2a2aa8(0x121)+_0x4859f0),_0x1d3c24(_0x4859f0);}});}function callSentComponents(_0xfb004a,_0x201918,_0x363e29){return new Promise((_0x184cb8,_0x1340af)=>{const _0x36bae8=a34_0x3810;try{const _0x3eae16={'methodType':constants[_0x36bae8(0x10c)],'body':JSON[_0x36bae8(0xd6)](_0x363e29)};http[_0x36bae8(0x128)](_0xfb004a,_0x201918[_0x36bae8(0x118)]('__',''),JSON[_0x36bae8(0xd6)](_0x3eae16))[_0x36bae8(0x10e)](()=>{_0x184cb8();})[_0x36bae8(0xd8)](_0x1340af);}catch(_0x3d2316){_0x1340af(_0x3d2316);}});}function completeDeployment(_0x1f6ddc,_0xc65cb6,_0x528798,_0x5c96bc,_0x495fa1,_0xbde67e,_0x4b702e,_0x518674,_0x3459e5=![]){return new Promise((_0xe5573a,_0x1faa68)=>{const _0x4442f8=a34_0x3810;try{Promise['resolve']()[_0x4442f8(0x10e)](()=>updateAttachmentLog(_0x1f6ddc,_0xc65cb6,_0xbde67e,_0x518674,_0x3459e5,!![]))[_0x4442f8(0x10e)](_0x121845=>{const _0x34fe08=_0x4442f8;return _0x3459e5=_0x121845,http[_0x34fe08(0x11d)](_0xc65cb6,_0x495fa1,_0x528798,_0x4b702e,_0x518674,_0x121845);})[_0x4442f8(0x10e)](()=>callUpdateSnapshot(_0xc65cb6,_0x5c96bc,_0x528798,_0x3459e5,_0x518674));}catch(_0x145a4e){_0x1faa68(_0x145a4e);}});}function updateAttachmentLog(_0x3dc8a1,_0x2a406f,_0x143a36,_0x56e5a1,_0x4eb8bf,_0x1c5f4b=![]){return new Promise(_0x182a23=>{const _0x3a2533=a34_0x3810;try{_0x56e5a1[_0x3a2533(0x11f)](_0x3a2533(0x101)),Promise[_0x3a2533(0xd7)]()['then'](()=>http[_0x3a2533(0x109)](_0x2a406f,_0x143a36,_0x56e5a1))[_0x3a2533(0x10e)](_0x252eac=>http['callUpdateAttachmentLog'](_0x2a406f,_0x143a36,_0x252eac,_0x56e5a1,_0x4eb8bf))[_0x3a2533(0x10e)](()=>_0x182a23(_0x4eb8bf))[_0x3a2533(0xd8)](()=>_0x182a23(_0x4eb8bf));}catch(_0xc013e5){_0x56e5a1[_0x3a2533(0x11f)](_0x3a2533(0xd9)+_0xc013e5),_0x182a23(_0x4eb8bf);}});}function a34_0x3810(_0x47a85a,_0x29eace){const _0x37a8ef=a34_0x37a8();return a34_0x3810=function(_0x3810a4,_0x43517d){_0x3810a4=_0x3810a4-0xd5;let _0x51c4dd=_0x37a8ef[_0x3810a4];return _0x51c4dd;},a34_0x3810(_0x47a85a,_0x29eace);}function callUpdateSnapshot(_0x1dd965,_0x46c3fb,_0x56b393,_0x59e651,_0x1220b2){return new Promise((_0x3feec3,_0x54eb65)=>{const _0x3bbb60=a34_0x3810;try{_0x1220b2[_0x3bbb60(0x11f)]('Start\x20Update\x20Snapshot');const _0x484a97={'Id':_0x46c3fb,[_0x56b393+'Is_Completed__c']:!![],[_0x56b393+_0x3bbb60(0xea)]:_0x59e651};_0x1dd965[_0x3bbb60(0x11c)](_0x56b393,_0x484a97)['then'](()=>{const _0x1f7379=_0x3bbb60;_0x1220b2[_0x1f7379(0x11f)](_0x1f7379(0xdd)),_0x3feec3();})[_0x3bbb60(0xd8)](_0x2201cb=>{const _0x13d270=_0x3bbb60;_0x1220b2['log'](_0x13d270(0xe1)),_0x54eb65(_0x2201cb);});}catch(_0x33c06c){_0x1220b2[_0x3bbb60(0x11f)](_0x3bbb60(0xe1)),_0x54eb65(_0x33c06c);}});}function a34_0x37a8(){const _0xc5b2b6=['lwcComponentList','/services/data/v48.0/tooling/query?q=SELECT+Id,DeveloperName,Description+FROM+LightningComponentBundle+WHERE+DeveloperName=\x27','push','bundleResources','replace','body','Error\x20Extract\x20LWC\x20Dependencies\x20','lwcComponentOverride','updateSnapshot','callUpdateLog','Custom\x20Lightning\x20Web\x20Component','log','children','Error\x20Send\x20Components\x20','apex',',\x20all\x20','Start\x20Create\x20Lwc\x20Files','length','50AEotcz','30ghFSAm','post','map','base64','(hidden)','propSetMap','parse','End\x20Query','Start\x20Extract\x20LWC\x20Dependencies','request','addFile','records','Source','stringify','resolve','catch','Error\x20Update\x20Attachment\x20Log\x20','Error\x20Fetch\x20OmniOut\x20Content\x20List\x20','eleArray','Vlocity\x20BuildJSONWithPrefill','End\x20Update\x20Snapshot','419274PLoxEA','from','372097Uxnsbp','Error\x20Update\x20Snapshot','321arRuMw',',\x20retrieved\x20','exports','End\x20Fetch\x20OmniOut\x20Content\x20List\x20','toString','compositeResponse','Error\x20Query\x20','vlocity_cmt__SubType__c','Is_Error__c','vlocity_cmt','../../../services/http','FilePath','Error\x20Get\x20Dependency\x20List\x20','7dAoXEo','767895MWbxAT','elementTypeToLwcTemplateMapping','4311BqkKvf','vlocity_cmt__Type__c','2079390nLjeIz','name','LightningComponentBundle','POST','Process\x20Get\x20Dependency,\x20processed\x20','8ztRvPA','/vlocity_cmt/v1/GenericInvoke/','forEach','toBuffer','vlocity_cmt__','DeveloperName','MAX_SIZE_UNZIP_ATTACHMENT','Error\x20getPrefilledJSON\x20','Start\x20Update\x20Attachment\x20Log','136otCKIX','Start\x20Get\x20Dependency\x20List\x20','End\x20Create\x20Lwc\x20Files','End\x20Extract\x20LWC\x20Dependencies','End\x20Get\x20Dependency\x20List\x20','vlocity_cmt__Language__c','query','getAttachmentBody','GET','6732528xjbNtL','METHOD_TYPE_ADD_COMPONENTS_TO_SNAPSHOT','application/json','then','Start\x20Fetch\x20OmniOut\x20Content\x20List\x20','Error\x20Create\x20Lwc\x20Files\x20','bundleInfo','adm-zip','httpStatusCode'];a34_0x37a8=function(){return _0xc5b2b6;};return a34_0x37a8();}function getDependencyList(_0x57b72e,_0x3ffbbe,_0x29ee20){return new Promise((_0xa6ac6d,_0x1bec45)=>{const _0x4c1dda=a34_0x3810;try{_0x29ee20['log'](_0x4c1dda(0x103));const _0x436667=[];let _0x340b65=Promise[_0x4c1dda(0xd7)]();_0x3ffbbe['forEach'](_0x2abc74=>{const _0x127c98=_0x4c1dda;_0x340b65=_0x340b65['then'](()=>getPrefilledJSON(_0x57b72e,_0x2abc74,_0x29ee20))[_0x127c98(0x10e)](_0xf2277=>{const _0x4419ee=_0x127c98;_0x436667[_0x4419ee(0x116)](_0xf2277),_0x29ee20[_0x4419ee(0x11f)](_0x4419ee(0xf8)+_0x436667['length']+'\x20from\x20'+_0x3ffbbe[_0x4419ee(0x125)]);});}),_0x340b65[_0x4c1dda(0x10e)](()=>{const _0x26a04e=_0x4c1dda;_0x29ee20[_0x26a04e(0x11f)](_0x26a04e(0x106)),_0xa6ac6d(_0x436667);})['catch'](_0x2c95e5=>{const _0x49eb5d=_0x4c1dda;_0x29ee20[_0x49eb5d(0x11f)]('Error\x20Get\x20Dependency\x20List\x20'+_0x2c95e5),_0x1bec45(_0x2c95e5);});}catch(_0x4a980e){_0x29ee20['log'](_0x4c1dda(0xee)+_0x4a980e),_0x1bec45(_0x4a980e);}});}function getPrefilledJSON(_0x244bcf,_0x448c3b,_0x5343fc){return new Promise((_0x9fa384,_0x14a63d)=>{const _0x131f97=a34_0x3810;try{const _0x29fdfc={'sClassName':_0x131f97(0xdc),'sType':_0x448c3b[_0x131f97(0xf3)],'sSubType':_0x448c3b['vlocity_cmt__SubType__c'],'sLang':_0x448c3b[_0x131f97(0x107)]};_0x244bcf[_0x131f97(0x122)][_0x131f97(0x128)](_0x131f97(0xfa),_0x29fdfc,(_0x1234d2,_0x57fd6f)=>{const _0x47c05a=_0x131f97;_0x1234d2?(_0x5343fc[_0x47c05a(0x11f)](_0x47c05a(0x100)+_0x1234d2),_0x14a63d(_0x1234d2)):_0x9fa384(JSON[_0x47c05a(0x12d)](_0x57fd6f));});}catch(_0x5404dd){_0x14a63d(_0x5404dd),_0x5343fc[_0x131f97(0x11f)]('Error\x20Get\x20Prefilled\x20JSON\x20'+_0x5404dd);}});}function extractLwcDependencies(_0x2d7ed7,_0x428dfd){return new Promise((_0x1e4572,_0x50116f)=>{const _0x1dc070=a34_0x3810;try{_0x428dfd[_0x1dc070(0x11f)](_0x1dc070(0x12f));const _0x318197=[];_0x2d7ed7['forEach'](_0x4b1fa2=>{const _0x331162=_0x1dc070;_0x4b1fa2[_0x331162(0x120)]&&_0x4b1fa2[_0x331162(0x120)][_0x331162(0x125)]>0x0&&_0x4b1fa2[_0x331162(0x120)][_0x331162(0xfb)](_0x25df48=>{const _0x405028=_0x331162;_0x25df48[_0x405028(0x120)]&&_0x25df48[_0x405028(0x120)][_0x405028(0x125)]>0x0&&_0x25df48['children'][_0x405028(0xfb)](_0x51f0dd=>{const _0x962c7e=_0x405028;_0x51f0dd['eleArray'][0x0]['type']===_0x962c7e(0x11e)&&_0x318197[_0x962c7e(0x116)](_0x51f0dd['eleArray'][0x0]['propSetMap']['lwcName']);});});if(_0x4b1fa2['propSetMap']&&_0x4b1fa2[_0x331162(0x12c)][_0x331162(0xf1)])for(const [_0x54cbca,_0x19ac8d]of Object['entries'](_0x4b1fa2['propSetMap']['elementTypeToLwcTemplateMapping'])){_0x318197[_0x331162(0x116)](_0x19ac8d);}_0x4b1fa2[_0x331162(0x120)]&&_0x4b1fa2[_0x331162(0x120)]['length']>0x0&&_0x4b1fa2[_0x331162(0x120)]['forEach'](_0x2f2cc6=>{const _0x1e6ef5=_0x331162;_0x2f2cc6[_0x1e6ef5(0x12c)]&&_0x2f2cc6['propSetMap'][_0x1e6ef5(0x11b)]&&_0x318197[_0x1e6ef5(0x116)](_0x2f2cc6[_0x1e6ef5(0x12c)]['lwcComponentOverride']),_0x2f2cc6[_0x1e6ef5(0x120)]&&_0x2f2cc6[_0x1e6ef5(0x120)][_0x1e6ef5(0x125)]>0x0&&_0x2f2cc6[_0x1e6ef5(0x120)][_0x1e6ef5(0xfb)](_0x56e64d=>{const _0x5868fb=_0x1e6ef5;_0x56e64d[_0x5868fb(0xdb)][0x0][_0x5868fb(0x12c)]&&_0x56e64d[_0x5868fb(0xdb)][0x0][_0x5868fb(0x12c)][_0x5868fb(0x11b)]&&_0x318197[_0x5868fb(0x116)](_0x56e64d['eleArray'][0x0][_0x5868fb(0x12c)]['lwcComponentOverride']);});});}),_0x428dfd[_0x1dc070(0x11f)](_0x1dc070(0x105)),_0x1e4572(_0x318197);}catch(_0x5a5481){_0x428dfd['log'](_0x1dc070(0x11a)+_0x5a5481),_0x50116f(_0x5a5481);}});}module[a34_0x2d4d95(0xe4)]={'query':query,'getDependencyList':getDependencyList,'extractLwcDependencies':extractLwcDependencies,'fetchOmniOutContentList':fetchOmniOutContentList,'createLwcFiles':createLwcFiles,'sendComponents':sendComponents,'completeDeployment':completeDeployment};