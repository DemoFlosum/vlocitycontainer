const a26_0xac47c0=a26_0x114c;(function(_0x33fc14,_0x345483){const _0x1f0d23=a26_0x114c,_0x50a223=_0x33fc14();while(!![]){try{const _0x3f1520=-parseInt(_0x1f0d23(0x1d7))/0x1+-parseInt(_0x1f0d23(0x1d2))/0x2*(parseInt(_0x1f0d23(0x1c7))/0x3)+-parseInt(_0x1f0d23(0x1ae))/0x4+-parseInt(_0x1f0d23(0x183))/0x5*(-parseInt(_0x1f0d23(0x1be))/0x6)+parseInt(_0x1f0d23(0x18a))/0x7*(parseInt(_0x1f0d23(0x1d6))/0x8)+parseInt(_0x1f0d23(0x18f))/0x9+-parseInt(_0x1f0d23(0x1a1))/0xa*(-parseInt(_0x1f0d23(0x18b))/0xb);if(_0x3f1520===_0x345483)break;else _0x50a223['push'](_0x50a223['shift']());}catch(_0x13a01a){_0x50a223['push'](_0x50a223['shift']());}}}(a26_0x3c88,0x22855));const path=require('path'),fs=require('fs'),fse=require('fs-extra'),AdmZip=require(a26_0xac47c0(0x198)),constants=require(a26_0xac47c0(0x1d1)),http=require('../../../services/http');function query(_0x4bf454,_0x5a05df,_0x274485){return new Promise((_0x84ac1d,_0x60eb73)=>{const _0x3a9053=a26_0x114c;try{_0x274485[_0x3a9053(0x1dd)](_0x3a9053(0x1c0)),_0x4bf454['query'](_0x5a05df,(_0x32dcc7,_0x54af38)=>{const _0x34f7da=_0x3a9053;_0x32dcc7?(_0x274485[_0x34f7da(0x1dd)](_0x34f7da(0x1b1)+_0x32dcc7),_0x60eb73(_0x32dcc7)):(_0x274485['log'](_0x34f7da(0x1a6)),_0x84ac1d(_0x54af38[_0x34f7da(0x180)][_0x34f7da(0x1d8)](_0x17f65b=>_0x17f65b[_0x34f7da(0x197)]&&_0x17f65b[_0x34f7da(0x1b9)]&&_0x17f65b[_0x34f7da(0x17d)])[_0x34f7da(0x193)](({vlocity_cmt__Type__c:_0x35fb10,vlocity_cmt__SubType__c:_0x27a72,vlocity_cmt__Language__c:_0x4ec0af})=>{return''+_0x35fb10+_0x27a72+_0x4ec0af;})));});}catch(_0x1abb1f){_0x60eb73(_0x1abb1f),_0x274485[_0x3a9053(0x1dd)]('Error\x20Query\x20'+_0x1abb1f);}});}function fetchOmniOutContentList(_0x5b0ad7,_0x5d095c,_0x19f152){return new Promise((_0x48d011,_0x4acdec)=>{const _0x2c6e67=a26_0x114c;try{_0x19f152[_0x2c6e67(0x1dd)](_0x2c6e67(0x182));const _0x3f000f=[];let _0x3e0bbf=0x1,_0x25b79a=Promise[_0x2c6e67(0x1ba)]();_0x5d095c['forEach'](_0x5cea3c=>{const _0xb070c7=_0x2c6e67;_0x25b79a=_0x25b79a[_0xb070c7(0x1a8)](()=>fetchOmniOutContent(_0x5b0ad7,_0x5cea3c))[_0xb070c7(0x1a8)](_0x542f8f=>{const _0x3d1ed3=_0xb070c7;_0x542f8f&&_0x542f8f[_0x3d1ed3(0x1bb)]&&_0x542f8f[_0x3d1ed3(0x1bb)]['length']===0x2&&(_0x542f8f[_0x3d1ed3(0x1bb)][0x0][_0x3d1ed3(0x1d0)]===0xc8&&_0x3f000f[_0x3d1ed3(0x1b5)]({'lwcComponentList':_0x542f8f[_0x3d1ed3(0x1bb)][0x1][_0x3d1ed3(0x199)][_0x3d1ed3(0x180)],'name':_0x542f8f[_0x3d1ed3(0x1bb)][0x0]['body']['records'][0x0][_0x3d1ed3(0x1b7)]})),_0x19f152['log'](_0x3d1ed3(0x17b)+_0x3e0bbf++ +_0x3d1ed3(0x196)+_0x3f000f[_0x3d1ed3(0x1c8)]+_0x3d1ed3(0x1cc)+_0x5d095c[_0x3d1ed3(0x1c8)]);});}),_0x25b79a[_0x2c6e67(0x1a8)](()=>{const _0x544e26=_0x2c6e67;_0x19f152[_0x544e26(0x1dd)](_0x544e26(0x1c2)),_0x48d011(_0x3f000f);})[_0x2c6e67(0x1a0)](_0x4706b0=>{const _0x2b768f=_0x2c6e67;_0x19f152[_0x2b768f(0x1dd)](_0x2b768f(0x1bf)+_0x4706b0),_0x4acdec(_0x4706b0);});}catch(_0x294672){_0x4acdec(_0x294672),_0x19f152[_0x2c6e67(0x1dd)](_0x2c6e67(0x1bf)+_0x294672);}});}function a26_0x114c(_0x866651,_0x3a2747){const _0x3c8866=a26_0x3c88();return a26_0x114c=function(_0x114c5f,_0x5c5aef){_0x114c5f=_0x114c5f-0x17b;let _0x2dc451=_0x3c8866[_0x114c5f];return _0x2dc451;},a26_0x114c(_0x866651,_0x3a2747);}function fetchOmniOutContent(_0xdf31b3,_0x3912e7){const _0x1b416e=a26_0xac47c0;_0x3912e7=_0x3912e7[_0x1b416e(0x185)]('-','')[_0x1b416e(0x185)](_0x1b416e(0x181),'');const _0x6af005={'allOrNone':!![],'compositeRequest':[{'method':'GET','referenceId':'bundleInfo','url':'/services/data/v48.0/tooling/query?q=SELECT+Id,DeveloperName,Description+FROM+LightningComponentBundle+WHERE+DeveloperName=\x27'+_0x3912e7+'\x27'},{'method':_0x1b416e(0x1a2),'referenceId':_0x1b416e(0x187),'url':_0x1b416e(0x1c4)}]},_0x1bb68c=_0xdf31b3[_0x1b416e(0x1b4)],_0x10a417={'method':'POST','url':_0x1bb68c+_0x1b416e(0x19b),'body':JSON['stringify'](_0x6af005),'headers':{'Content-Type':_0x1b416e(0x192)}};return _0xdf31b3[_0x1b416e(0x1a5)](_0x10a417);}function createLwcFiles(_0x2e84b8,_0x3a9dd9,_0x15e5c1,_0x28bc2f){return new Promise((_0x408b7b,_0xf12780)=>{const _0x13ff24=a26_0x114c;try{_0x28bc2f[_0x13ff24(0x1dd)](_0x13ff24(0x18d));let _0x29f564=[],_0x17dfae=[],_0x1cd8bc=0x0,_0x52c5f4=new AdmZip();_0x3a9dd9[_0x13ff24(0x1b3)](_0x354681=>{const _0x5297ad=_0x13ff24;_0x17dfae[_0x5297ad(0x1b5)]({'apiName':_0x354681[_0x5297ad(0x190)],'componentType':_0x5297ad(0x191),'label':_0x5297ad(0x18e)+_0x354681[_0x5297ad(0x190)]}),_0x354681[_0x5297ad(0x1cf)]['forEach'](_0x36fc44=>{const _0x827acf=_0x5297ad;_0x36fc44['Source']!==_0x827acf(0x1ca)&&(_0x1cd8bc+=_0x36fc44[_0x827acf(0x189)][_0x827acf(0x1c8)],_0x1cd8bc<constants['MAX_SIZE_UNZIP_ATTACHMENT']?_0x52c5f4['addFile'](''+_0x36fc44[_0x827acf(0x19d)],Buffer['from'](_0x36fc44['Source']['replace'](new RegExp(_0x827acf(0x19f),'g'),'c'))):(_0x29f564[_0x827acf(0x1b5)]({'snapshotId':_0x15e5c1,'typeList':[{'type':_0x827acf(0x191),'zip':_0x52c5f4[_0x827acf(0x1af)]()[_0x827acf(0x1c6)]('base64'),'componentList':_0x17dfae}]}),_0x17dfae=[],_0x1cd8bc=0x0,_0x52c5f4=new AdmZip()));}),delete _0x354681[_0x5297ad(0x1cf)];}),_0x17dfae[_0x13ff24(0x1c8)]&&_0x29f564[_0x13ff24(0x1b5)]({'snapshotId':_0x15e5c1,'typeList':[{'type':_0x13ff24(0x191),'zip':_0x52c5f4['toBuffer']()[_0x13ff24(0x1c6)](_0x13ff24(0x1d5)),'componentList':_0x17dfae}]}),_0x28bc2f[_0x13ff24(0x1dd)](_0x13ff24(0x19e)),_0x408b7b(_0x29f564);}catch(_0xb16990){_0x28bc2f['log'](_0x13ff24(0x1da)+_0xb16990),_0xf12780(_0xb16990);}});}function a26_0x3c88(){const _0x50c575=['/services/apexrest/','336HAUoeA','Error\x20Fetch\x20OmniOut\x20Content\x20List\x20','Start\x20Query','METHOD_TYPE_ADD_COMPONENTS_TO_SNAPSHOT','End\x20Fetch\x20OmniOut\x20Content\x20List\x20','Error\x20Send\x20Components\x20','/services/data/v48.0/tooling/query?q=SELECT+Id,FilePath,Format,Source+FROM+LightningComponentResource+WHERE+LightningComponentBundleId=\x27@{bundleInfo.records[0].Id}\x27','type','toString','1767aLLdBc','length','propSetMap','(hidden)','eleArray',',\x20all\x20','exports','Start\x20Get\x20Dependency\x20List\x20','lwcComponentList','httpStatusCode','../../../constants','446oWluSK','End\x20Update\x20Snapshot','Error\x20Extract\x20LWC\x20Dependencies\x20','base64','472ntYZek','181742XxgBKF','filter','Error\x20Get\x20Dependency\x20List\x20','Error\x20Create\x20Lwc\x20Files\x20','Start\x20Update\x20Attachment\x20Log','post','log','Process\x20Fetch\x20OmniOut\x20Content,\x20processed\x20','stringify','vlocity_cmt__Language__c','Process\x20Get\x20Dependency,\x20processed\x20','lwcComponentOverride','records','vlocity_cmt__','Start\x20Fetch\x20OmniOut\x20Content\x20List\x20','5075DVhkmU','callUpdateAttachmentLog','replace','update','bundleResources','children','Source','31703EFspUO','30657pThigm','callUpdateLog','Start\x20Create\x20Lwc\x20Files','lwc/','1376316ofHyFE','name','LightningComponentBundle','application/json','map','Start\x20Update\x20Snapshot','Custom\x20Lightning\x20Web\x20Component',',\x20retrieved\x20','vlocity_cmt__Type__c','adm-zip','body','elementTypeToLwcTemplateMapping','/services/data/v50.0/tooling/composite','Snapshot__c','FilePath','End\x20Create\x20Lwc\x20Files','vlocity_cmt','catch','530KXCgqY','GET','Is_Completed__c','parse','request','End\x20Query','entries','then','lwcName','Vlocity\x20BuildJSONWithPrefill','Error\x20Update\x20Attachment\x20Log\x20','unlocked-packages','Start\x20Send\x20Components','680800hyAOEM','toBuffer','Error\x20Update\x20Snapshot','Error\x20Query\x20','Is_Error__c','forEach','instanceUrl','push','Error\x20getPrefilledJSON\x20','DeveloperName','End\x20Send\x20Components','vlocity_cmt__SubType__c','resolve','compositeResponse','End\x20Extract\x20LWC\x20Dependencies'];a26_0x3c88=function(){return _0x50c575;};return a26_0x3c88();}function sendComponents(_0x2bcadc,_0x218c65,_0x4f7f61,_0x30eb82,_0xd6fc16){return new Promise((_0xbfb07b,_0x506c22)=>{const _0x14591f=a26_0x114c;try{_0xd6fc16[_0x14591f(0x1dd)](_0x14591f(0x1ad));let _0x339490=Promise['resolve']();_0x30eb82[_0x14591f(0x1b3)](_0x268a6a=>{_0x339490=_0x339490['then'](()=>callSentComponents(_0x2bcadc,_0x218c65,_0x4f7f61,_0x268a6a));}),_0x339490[_0x14591f(0x1a8)](()=>{const _0x22770b=_0x14591f;_0xd6fc16[_0x22770b(0x1dd)](_0x22770b(0x1b8)),_0xbfb07b();})[_0x14591f(0x1a0)](_0x5429bf=>{const _0x344bc2=_0x14591f;_0xd6fc16[_0x344bc2(0x1dd)](_0x344bc2(0x1c3)+_0x5429bf),_0x506c22(_0x5429bf);});}catch(_0x221391){_0xd6fc16[_0x14591f(0x1dd)](_0x14591f(0x1c3)+_0x221391),_0x506c22(_0x221391);}});}function callSentComponents(_0x5f2301,_0x5c1f3c,_0x537e9e,_0x16e09d){return new Promise((_0x234b25,_0xefc5c8)=>{const _0x4b26ee=a26_0x114c;try{const _0x1e0497={'methodType':constants[_0x4b26ee(0x1c1)],'body':JSON[_0x4b26ee(0x17c)](_0x16e09d)};_0x537e9e=_0x537e9e?_0x537e9e['replace']('__','')+'/':'';const _0xe031ce=_0x5f2301+_0x4b26ee(0x1bd)+_0x537e9e[_0x4b26ee(0x185)]('__','')+_0x4b26ee(0x1ac);http[_0x4b26ee(0x1dc)](_0xe031ce,_0x5c1f3c,_0x537e9e[_0x4b26ee(0x185)]('__',''),JSON['stringify'](_0x1e0497))[_0x4b26ee(0x1a8)](()=>{_0x234b25();})[_0x4b26ee(0x1a0)](_0xefc5c8);}catch(_0x388b30){_0xefc5c8(_0x388b30);}});}function completeDeployment(_0x592162,_0x186afd,_0x556bd1,_0x176e6a,_0xb32bef,_0x3c5a92,_0x2ab532,_0x17e1c4,_0x599834=![]){return new Promise((_0x18f41d,_0x14592c)=>{const _0x210cab=a26_0x114c;try{Promise['resolve']()['then'](()=>updateAttachmentLog(_0x592162,_0x186afd,_0x3c5a92,_0x17e1c4,_0x599834,!![]))[_0x210cab(0x1a8)](_0x37556d=>{const _0x275dce=_0x210cab;return _0x599834=_0x37556d,http[_0x275dce(0x18c)](_0x186afd,_0xb32bef,_0x556bd1,_0x2ab532,_0x17e1c4,_0x37556d);})[_0x210cab(0x1a8)](()=>callUpdateSnapshot(_0x186afd,_0x176e6a,_0x556bd1,_0x599834,_0x17e1c4));}catch(_0x2685f7){_0x14592c(_0x2685f7);}});}function updateAttachmentLog(_0x152c4b,_0x570a9c,_0x3613f3,_0xaff395,_0x3c4555,_0x360680=![]){return new Promise(_0x1c74b0=>{const _0x1816c9=a26_0x114c;try{_0xaff395[_0x1816c9(0x1dd)](_0x1816c9(0x1db)),Promise[_0x1816c9(0x1ba)]()[_0x1816c9(0x1a8)](()=>http['getAttachmentBody'](_0x570a9c,_0x3613f3,_0xaff395))[_0x1816c9(0x1a8)](_0x35da64=>{const _0x2f2f4b=_0x1816c9;return http[_0x2f2f4b(0x184)](_0x570a9c,_0x3613f3,_0x35da64,_0xaff395,_0x3c4555);})[_0x1816c9(0x1a8)](()=>_0x1c74b0(_0x3c4555))[_0x1816c9(0x1a0)](()=>_0x1c74b0(_0x3c4555));}catch(_0xed690a){_0xaff395[_0x1816c9(0x1dd)](_0x1816c9(0x1ab)+_0xed690a),_0x1c74b0(_0x3c4555);}});}function callUpdateSnapshot(_0x25c7a6,_0x3308cf,_0x2c130d,_0xaf235,_0x4eeb87){return new Promise((_0xd3cd35,_0x1243b2)=>{const _0x198380=a26_0x114c;try{_0x4eeb87['log'](_0x198380(0x194));const _0xc16862={'Id':_0x3308cf,[_0x2c130d+_0x198380(0x1a3)]:!![],[_0x2c130d+_0x198380(0x1b2)]:_0xaf235};_0x25c7a6['sobject'](_0x2c130d+_0x198380(0x19c))[_0x198380(0x186)](_0xc16862)[_0x198380(0x1a8)](()=>{const _0x5a2333=_0x198380;_0x4eeb87[_0x5a2333(0x1dd)](_0x5a2333(0x1d3)),_0xd3cd35();})[_0x198380(0x1a0)](_0x508548=>{_0x4eeb87['log']('Error\x20Update\x20Snapshot'),_0x1243b2(_0x508548);});}catch(_0x4e1fe1){_0x4eeb87[_0x198380(0x1dd)](_0x198380(0x1b0)),_0x1243b2(_0x4e1fe1);}});}function getDependencyList(_0x251e82,_0x27a689,_0x5828b6){return new Promise((_0x1039ae,_0x6fe1de)=>{const _0x5c7f77=a26_0x114c;try{_0x5828b6[_0x5c7f77(0x1dd)](_0x5c7f77(0x1ce));const _0x1e7911=[];let _0x378287=Promise[_0x5c7f77(0x1ba)]();_0x27a689[_0x5c7f77(0x1b3)](_0x1a5b1f=>{const _0x252a8b=_0x5c7f77;_0x378287=_0x378287[_0x252a8b(0x1a8)](()=>getPrefilledJSON(_0x251e82,_0x1a5b1f,_0x5828b6))[_0x252a8b(0x1a8)](_0x19961f=>{const _0x4a8c07=_0x252a8b;_0x1e7911[_0x4a8c07(0x1b5)](_0x19961f),_0x5828b6[_0x4a8c07(0x1dd)](_0x4a8c07(0x17e)+_0x1e7911['length']+'\x20from\x20'+_0x27a689[_0x4a8c07(0x1c8)]);});}),_0x378287[_0x5c7f77(0x1a8)](()=>{const _0x2cad4f=_0x5c7f77;_0x5828b6[_0x2cad4f(0x1dd)]('End\x20Get\x20Dependency\x20List\x20'),_0x1039ae(_0x1e7911);})[_0x5c7f77(0x1a0)](_0x17adbd=>{const _0x35dcc0=_0x5c7f77;_0x5828b6[_0x35dcc0(0x1dd)](_0x35dcc0(0x1d9)+_0x17adbd),_0x6fe1de(_0x17adbd);});}catch(_0x1cc3e9){_0x5828b6['log'](_0x5c7f77(0x1d9)+_0x1cc3e9),_0x6fe1de(_0x1cc3e9);}});}function getPrefilledJSON(_0x5ba1bd,_0x1bc8e8,_0x4784db){return new Promise((_0x37da36,_0x5d0129)=>{const _0x10a43d=a26_0x114c;try{const _0x33b618={'sClassName':_0x10a43d(0x1aa),'sType':_0x1bc8e8['vlocity_cmt__Type__c'],'sSubType':_0x1bc8e8[_0x10a43d(0x1b9)],'sLang':_0x1bc8e8[_0x10a43d(0x17d)]};_0x5ba1bd['apex']['post']('/vlocity_cmt/v1/GenericInvoke/',_0x33b618,(_0x13b27,_0x27622e)=>{const _0x6b8bdc=_0x10a43d;_0x13b27?(_0x4784db[_0x6b8bdc(0x1dd)](_0x6b8bdc(0x1b6)+_0x13b27),_0x5d0129(_0x13b27)):_0x37da36(JSON[_0x6b8bdc(0x1a4)](_0x27622e));});}catch(_0x29c32b){_0x5d0129(_0x29c32b),_0x4784db[_0x10a43d(0x1dd)]('Error\x20Get\x20Prefilled\x20JSON\x20'+_0x29c32b);}});}function extractLwcDependencies(_0x54deeb,_0x269e8a){return new Promise((_0x4f7c28,_0x6850d5)=>{const _0x1451db=a26_0x114c;try{_0x269e8a[_0x1451db(0x1dd)]('Start\x20Extract\x20LWC\x20Dependencies');let _0x58ef5b=[];_0x54deeb['forEach'](_0x4beb5e=>{const _0x3be936=_0x1451db;_0x4beb5e[_0x3be936(0x188)]&&_0x4beb5e[_0x3be936(0x188)][_0x3be936(0x1c8)]>0x0&&_0x4beb5e[_0x3be936(0x188)]['forEach'](_0x482f4c=>{const _0xadee5=_0x3be936;_0x482f4c['children']&&_0x482f4c[_0xadee5(0x188)][_0xadee5(0x1c8)]>0x0&&_0x482f4c[_0xadee5(0x188)][_0xadee5(0x1b3)](_0x20cfdc=>{const _0x586569=_0xadee5;_0x20cfdc[_0x586569(0x1cb)][0x0][_0x586569(0x1c5)]===_0x586569(0x195)&&_0x58ef5b[_0x586569(0x1b5)](_0x20cfdc[_0x586569(0x1cb)][0x0][_0x586569(0x1c9)][_0x586569(0x1a9)]);});});if(_0x4beb5e['propSetMap']&&_0x4beb5e[_0x3be936(0x1c9)][_0x3be936(0x19a)])for(const [_0x4e4d64,_0x2b89ec]of Object[_0x3be936(0x1a7)](_0x4beb5e[_0x3be936(0x1c9)][_0x3be936(0x19a)])){_0x58ef5b[_0x3be936(0x1b5)](_0x2b89ec);}_0x4beb5e[_0x3be936(0x188)]&&_0x4beb5e[_0x3be936(0x188)][_0x3be936(0x1c8)]>0x0&&_0x4beb5e[_0x3be936(0x188)]['forEach'](_0xb61dff=>{const _0x5c9832=_0x3be936;_0xb61dff[_0x5c9832(0x1c9)]&&_0xb61dff[_0x5c9832(0x1c9)]['lwcComponentOverride']&&_0x58ef5b['push'](_0xb61dff['propSetMap']['lwcComponentOverride']),_0xb61dff['children']&&_0xb61dff['children'][_0x5c9832(0x1c8)]>0x0&&_0xb61dff['children']['forEach'](_0x39dddb=>{const _0x39b486=_0x5c9832;_0x39dddb[_0x39b486(0x1cb)][0x0]['propSetMap']&&_0x39dddb[_0x39b486(0x1cb)][0x0]['propSetMap']['lwcComponentOverride']&&_0x58ef5b[_0x39b486(0x1b5)](_0x39dddb[_0x39b486(0x1cb)][0x0][_0x39b486(0x1c9)][_0x39b486(0x17f)]);});});}),_0x269e8a[_0x1451db(0x1dd)](_0x1451db(0x1bc)),_0x4f7c28(_0x58ef5b);}catch(_0x5ae73a){_0x269e8a[_0x1451db(0x1dd)](_0x1451db(0x1d4)+_0x5ae73a),_0x6850d5(_0x5ae73a);}});}module[a26_0xac47c0(0x1cd)]={'query':query,'getDependencyList':getDependencyList,'extractLwcDependencies':extractLwcDependencies,'fetchOmniOutContentList':fetchOmniOutContentList,'createLwcFiles':createLwcFiles,'sendComponents':sendComponents,'completeDeployment':completeDeployment};