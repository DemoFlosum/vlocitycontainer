const a33_0x28d2d2=a33_0x5bb8;(function(_0x55bb9b,_0x287b87){const _0x434b10=a33_0x5bb8,_0x3c35f8=_0x55bb9b();while(!![]){try{const _0x527e53=parseInt(_0x434b10(0x20a))/0x1*(-parseInt(_0x434b10(0x236))/0x2)+-parseInt(_0x434b10(0x1e9))/0x3+-parseInt(_0x434b10(0x231))/0x4*(parseInt(_0x434b10(0x22e))/0x5)+-parseInt(_0x434b10(0x23b))/0x6*(-parseInt(_0x434b10(0x209))/0x7)+parseInt(_0x434b10(0x206))/0x8+parseInt(_0x434b10(0x1fe))/0x9*(parseInt(_0x434b10(0x1ea))/0xa)+parseInt(_0x434b10(0x245))/0xb;if(_0x527e53===_0x287b87)break;else _0x3c35f8['push'](_0x3c35f8['shift']());}catch(_0x36ceb4){_0x3c35f8['push'](_0x3c35f8['shift']());}}}(a33_0x4dff,0x641ef));const path=require(a33_0x28d2d2(0x226)),fs=require('fs'),fse=require(a33_0x28d2d2(0x1e5)),AdmZip=require(a33_0x28d2d2(0x1ee)),constants=require('../../../constants'),http=require('../../../services/http');function query(_0x1faada,_0x4ddf08,_0x1a8c85){return new Promise((_0x302be9,_0x3c25dd)=>{const _0x497919=a33_0x5bb8;try{_0x1a8c85[_0x497919(0x217)](_0x497919(0x230)),_0x1faada[_0x497919(0x208)](_0x4ddf08,(_0x2b248a,_0xdde617)=>{const _0x4f8e57=_0x497919;_0x2b248a?(_0x1a8c85[_0x4f8e57(0x217)](_0x4f8e57(0x218)+_0x2b248a),_0x3c25dd(_0x2b248a)):(_0x1a8c85[_0x4f8e57(0x217)]('End\x20Query'),_0x302be9(_0xdde617[_0x4f8e57(0x224)]['filter'](_0x456f1e=>_0x456f1e[_0x4f8e57(0x1f9)]&&_0x456f1e[_0x4f8e57(0x237)]&&_0x456f1e[_0x4f8e57(0x227)])[_0x4f8e57(0x225)](({vlocity_cmt__Type__c:_0x22baaa,vlocity_cmt__SubType__c:_0xd6bd4e,vlocity_cmt__Language__c:_0x590e2c})=>{return''+_0x22baaa+_0xd6bd4e+_0x590e2c;})));});}catch(_0x253686){_0x3c25dd(_0x253686),_0x1a8c85[_0x497919(0x217)](_0x497919(0x218)+_0x253686);}});}function fetchOmniOutContentList(_0x16101a,_0x12c498,_0x1e6a6a){return new Promise((_0x150061,_0x29c9e1)=>{const _0x5a7b79=a33_0x5bb8;try{_0x1e6a6a[_0x5a7b79(0x217)](_0x5a7b79(0x200));const _0x48cf52=[];let _0x2e7477=0x1,_0x37372a=Promise[_0x5a7b79(0x202)]();_0x12c498['forEach'](_0x40dedc=>{const _0x2d87d6=_0x5a7b79;_0x37372a=_0x37372a[_0x2d87d6(0x1e4)](()=>fetchOmniOutContent(_0x16101a,_0x40dedc))[_0x2d87d6(0x1e4)](_0x1aaf68=>{const _0x4155b8=_0x2d87d6;_0x1aaf68&&_0x1aaf68[_0x4155b8(0x21c)]&&_0x1aaf68['compositeResponse'][_0x4155b8(0x223)]===0x2&&(_0x1aaf68[_0x4155b8(0x21c)][0x0]['httpStatusCode']===0xc8&&_0x48cf52[_0x4155b8(0x243)]({'lwcComponentList':_0x1aaf68[_0x4155b8(0x21c)][0x1][_0x4155b8(0x1f1)]['records'],'name':_0x1aaf68[_0x4155b8(0x21c)][0x0]['body'][_0x4155b8(0x224)][0x0][_0x4155b8(0x221)]})),_0x1e6a6a[_0x4155b8(0x217)](_0x4155b8(0x23c)+_0x2e7477++ +_0x4155b8(0x1f3)+_0x48cf52[_0x4155b8(0x223)]+',\x20all\x20'+_0x12c498[_0x4155b8(0x223)]);});}),_0x37372a[_0x5a7b79(0x1e4)](()=>{const _0x35b0e5=_0x5a7b79;_0x1e6a6a[_0x35b0e5(0x217)](_0x35b0e5(0x244)),_0x150061(_0x48cf52);})[_0x5a7b79(0x222)](_0x324c62=>{const _0x11572c=_0x5a7b79;_0x1e6a6a[_0x11572c(0x217)](_0x11572c(0x1f4)+_0x324c62),_0x29c9e1(_0x324c62);});}catch(_0x4bffdd){_0x29c9e1(_0x4bffdd),_0x1e6a6a['log'](_0x5a7b79(0x1f4)+_0x4bffdd);}});}function a33_0x5bb8(_0x140fd2,_0x541b6b){const _0x4dff29=a33_0x4dff();return a33_0x5bb8=function(_0x5bb84b,_0x434bfb){_0x5bb84b=_0x5bb84b-0x1e4;let _0x498805=_0x4dff29[_0x5bb84b];return _0x498805;},a33_0x5bb8(_0x140fd2,_0x541b6b);}function fetchOmniOutContent(_0x45ab72,_0xe780a3){const _0x20579d=a33_0x28d2d2;_0xe780a3=_0xe780a3[_0x20579d(0x1ff)]('-','')[_0x20579d(0x1ff)](_0x20579d(0x20c),'');const _0x2e4025={'allOrNone':!![],'compositeRequest':[{'method':_0x20579d(0x20b),'referenceId':_0x20579d(0x1f5),'url':_0x20579d(0x20f)+_0xe780a3+'\x27'},{'method':_0x20579d(0x20b),'referenceId':_0x20579d(0x233),'url':_0x20579d(0x240)}]},_0x3cc106=_0x45ab72['instanceUrl'],_0x1f5ba7={'method':_0x20579d(0x23d),'url':_0x3cc106+_0x20579d(0x1fb),'body':JSON[_0x20579d(0x1ed)](_0x2e4025),'headers':{'Content-Type':_0x20579d(0x1f2)}};return _0x45ab72['request'](_0x1f5ba7);}function createLwcFiles(_0x27a89f,_0x5576a0,_0x5d7441,_0x9812bf){return new Promise((_0x817dbe,_0x3be95d)=>{const _0x3a2ffd=a33_0x5bb8;try{_0x9812bf[_0x3a2ffd(0x217)](_0x3a2ffd(0x212));let _0xa9d552=[],_0x1fd23a=[],_0x419b01=0x0,_0x3f07a1=new AdmZip();_0x5576a0[_0x3a2ffd(0x23e)](_0x5e7c3d=>{const _0x3fe153=_0x3a2ffd;_0x1fd23a[_0x3fe153(0x243)]({'apiName':_0x5e7c3d['name'],'componentType':_0x3fe153(0x201),'label':_0x3fe153(0x1f6)+_0x5e7c3d[_0x3fe153(0x1ef)]}),_0x5e7c3d[_0x3fe153(0x211)][_0x3fe153(0x23e)](_0x2196da=>{const _0x3f3d00=_0x3fe153;_0x2196da[_0x3f3d00(0x21b)]!==_0x3f3d00(0x23a)&&(_0x419b01+=_0x2196da[_0x3f3d00(0x21b)][_0x3f3d00(0x223)],_0x419b01<constants[_0x3f3d00(0x238)]?_0x3f07a1['addFile'](''+_0x2196da[_0x3f3d00(0x21f)],Buffer['from'](_0x2196da[_0x3f3d00(0x21b)]['replace'](new RegExp(_0x3f3d00(0x242),'g'),'c'))):(_0xa9d552['push']({'snapshotId':_0x5d7441,'typeList':[{'type':'LightningComponentBundle','zip':_0x3f07a1[_0x3f3d00(0x23f)]()[_0x3f3d00(0x1fc)](_0x3f3d00(0x228)),'componentList':_0x1fd23a}]}),_0x1fd23a=[],_0x419b01=0x0,_0x3f07a1=new AdmZip()));}),delete _0x5e7c3d[_0x3fe153(0x211)];}),_0x1fd23a[_0x3a2ffd(0x223)]&&_0xa9d552[_0x3a2ffd(0x243)]({'snapshotId':_0x5d7441,'typeList':[{'type':_0x3a2ffd(0x201),'zip':_0x3f07a1[_0x3a2ffd(0x23f)]()[_0x3a2ffd(0x1fc)](_0x3a2ffd(0x228)),'componentList':_0x1fd23a}]}),_0x9812bf['log'](_0x3a2ffd(0x1f8)),_0x817dbe(_0xa9d552);}catch(_0xca69b6){_0x9812bf['log']('Error\x20Create\x20Lwc\x20Files\x20'+_0xca69b6),_0x3be95d(_0xca69b6);}});}function sendComponents(_0x30df91,_0x41b034,_0x4bdb7f,_0x459e7e,_0x4ed72a){return new Promise((_0xfe90d8,_0x373d1d)=>{const _0x4563f5=a33_0x5bb8;try{_0x4ed72a[_0x4563f5(0x217)](_0x4563f5(0x22c));let _0x161fc6=Promise[_0x4563f5(0x202)]();_0x459e7e['forEach'](_0x39446d=>{const _0x5c7ac9=_0x4563f5;_0x161fc6=_0x161fc6[_0x5c7ac9(0x1e4)](()=>callSentComponents(_0x30df91,_0x41b034,_0x4bdb7f,_0x39446d));}),_0x161fc6[_0x4563f5(0x1e4)](()=>{const _0x256d65=_0x4563f5;_0x4ed72a[_0x256d65(0x217)](_0x256d65(0x22a)),_0xfe90d8();})[_0x4563f5(0x222)](_0x2aa734=>{const _0x33eed5=_0x4563f5;_0x4ed72a['log'](_0x33eed5(0x1fd)+_0x2aa734),_0x373d1d(_0x2aa734);});}catch(_0x20abc4){_0x4ed72a[_0x4563f5(0x217)](_0x4563f5(0x1fd)+_0x20abc4),_0x373d1d(_0x20abc4);}});}function a33_0x4dff(){const _0x2c25ce=['path','vlocity_cmt__Language__c','base64','propSetMap','End\x20Send\x20Components','lwcComponentOverride','Start\x20Send\x20Components','End\x20Update\x20Snapshot','335RRNJuY','parse','Start\x20Query','11068Bzbuzr','Start\x20Extract\x20LWC\x20Dependencies','bundleResources','Error\x20Extract\x20LWC\x20Dependencies\x20','\x20from\x20','6kculSe','vlocity_cmt__SubType__c','MAX_SIZE_UNZIP_ATTACHMENT','Start\x20Get\x20Dependency\x20List\x20','(hidden)','28902YAMVXq','Process\x20Fetch\x20OmniOut\x20Content,\x20processed\x20','POST','forEach','toBuffer','/services/data/v48.0/tooling/query?q=SELECT+Id,FilePath,Format,Source+FROM+LightningComponentResource+WHERE+LightningComponentBundleId=\x27@{bundleInfo.records[0].Id}\x27','Error\x20getPrefilledJSON\x20','vlocity_cmt','push','End\x20Fetch\x20OmniOut\x20Content\x20List\x20','26807cQlHFB','getAttachmentBody','then','fs-extra','Process\x20Get\x20Dependency,\x20processed\x20','elementTypeToLwcTemplateMapping','children','1022553wNCecQ','20aHRXcA','unlocked-packages','Vlocity\x20BuildJSONWithPrefill','stringify','adm-zip','name','Snapshot__c','body','application/json',',\x20retrieved\x20','Error\x20Fetch\x20OmniOut\x20Content\x20List\x20','bundleInfo','lwc/','Is_Completed__c','End\x20Create\x20Lwc\x20Files','vlocity_cmt__Type__c','METHOD_TYPE_ADD_COMPONENTS_TO_SNAPSHOT','/services/data/v50.0/tooling/composite','toString','Error\x20Send\x20Components\x20','1832247MJjXyO','replace','Start\x20Fetch\x20OmniOut\x20Content\x20List\x20','LightningComponentBundle','resolve','lwcName','Custom\x20Lightning\x20Web\x20Component','type','1071608nwhnlG','Start\x20Update\x20Snapshot','query','756VScVos','42485heOTTs','GET','vlocity_cmt__','sobject','Error\x20Update\x20Attachment\x20Log\x20','/services/data/v48.0/tooling/query?q=SELECT+Id,DeveloperName,Description+FROM+LightningComponentBundle+WHERE+DeveloperName=\x27','post','lwcComponentList','Start\x20Create\x20Lwc\x20Files','/services/apexrest/','Error\x20Update\x20Snapshot','End\x20Get\x20Dependency\x20List\x20','update','log','Error\x20Query\x20','Error\x20Get\x20Dependency\x20List\x20','eleArray','Source','compositeResponse','exports','End\x20Extract\x20LWC\x20Dependencies','FilePath','entries','DeveloperName','catch','length','records','map'];a33_0x4dff=function(){return _0x2c25ce;};return a33_0x4dff();}function callSentComponents(_0x57144a,_0x11db65,_0x3136d9,_0x4f8cb2){return new Promise((_0x1508aa,_0x20cd0e)=>{const _0x22cda3=a33_0x5bb8;try{const _0x3d6da3={'methodType':constants[_0x22cda3(0x1fa)],'body':JSON[_0x22cda3(0x1ed)](_0x4f8cb2)};_0x3136d9=_0x3136d9?_0x3136d9['replace']('__','')+'/':'';const _0x1f39cd=_0x57144a+_0x22cda3(0x213)+_0x3136d9[_0x22cda3(0x1ff)]('__','')+_0x22cda3(0x1eb);http[_0x22cda3(0x210)](_0x1f39cd,_0x11db65,_0x3136d9['replace']('__',''),JSON[_0x22cda3(0x1ed)](_0x3d6da3))['then'](()=>{_0x1508aa();})['catch'](_0x20cd0e);}catch(_0x205433){_0x20cd0e(_0x205433);}});}function completeDeployment(_0x23210d,_0x4c1f57,_0x48abe7,_0x41e9c9,_0x5618a7,_0x515b16,_0x1f73f7,_0x48db1e,_0x58893b=![]){return new Promise((_0x451474,_0x5c2769)=>{const _0x9ce6e6=a33_0x5bb8;try{Promise[_0x9ce6e6(0x202)]()[_0x9ce6e6(0x1e4)](()=>updateAttachmentLog(_0x23210d,_0x4c1f57,_0x515b16,_0x48db1e,_0x58893b,!![]))[_0x9ce6e6(0x1e4)](_0x166a10=>{return _0x58893b=_0x166a10,http['callUpdateLog'](_0x4c1f57,_0x5618a7,_0x48abe7,_0x1f73f7,_0x48db1e,_0x166a10);})['then'](()=>callUpdateSnapshot(_0x4c1f57,_0x41e9c9,_0x48abe7,_0x58893b,_0x48db1e));}catch(_0x1c60ba){_0x5c2769(_0x1c60ba);}});}function updateAttachmentLog(_0x45d9fa,_0x38d95f,_0x49cfba,_0x425ca3,_0x47ffcb,_0x454182=![]){return new Promise(_0x596234=>{const _0x4a6309=a33_0x5bb8;try{_0x425ca3[_0x4a6309(0x217)]('Start\x20Update\x20Attachment\x20Log'),Promise[_0x4a6309(0x202)]()[_0x4a6309(0x1e4)](()=>http[_0x4a6309(0x246)](_0x38d95f,_0x49cfba,_0x425ca3))[_0x4a6309(0x1e4)](_0x3d924e=>{return http['callUpdateAttachmentLog'](_0x38d95f,_0x49cfba,_0x3d924e,_0x425ca3,_0x47ffcb);})['then'](()=>_0x596234(_0x47ffcb))[_0x4a6309(0x222)](()=>_0x596234(_0x47ffcb));}catch(_0x1c5496){_0x425ca3[_0x4a6309(0x217)](_0x4a6309(0x20e)+_0x1c5496),_0x596234(_0x47ffcb);}});}function callUpdateSnapshot(_0x18b35e,_0x350f05,_0x2cf451,_0x4e936f,_0x2c02a7){return new Promise((_0x53553e,_0x5be160)=>{const _0x30f890=a33_0x5bb8;try{_0x2c02a7[_0x30f890(0x217)](_0x30f890(0x207));const _0x4468dc={'Id':_0x350f05,[_0x2cf451+_0x30f890(0x1f7)]:!![],[_0x2cf451+'Is_Error__c']:_0x4e936f};_0x18b35e[_0x30f890(0x20d)](_0x2cf451+_0x30f890(0x1f0))[_0x30f890(0x216)](_0x4468dc)[_0x30f890(0x1e4)](()=>{const _0x32f293=_0x30f890;_0x2c02a7[_0x32f293(0x217)](_0x32f293(0x22d)),_0x53553e();})[_0x30f890(0x222)](_0x354e8c=>{const _0x1608de=_0x30f890;_0x2c02a7[_0x1608de(0x217)](_0x1608de(0x214)),_0x5be160(_0x354e8c);});}catch(_0x389328){_0x2c02a7[_0x30f890(0x217)](_0x30f890(0x214)),_0x5be160(_0x389328);}});}function getDependencyList(_0x355303,_0x4a4293,_0x2703a0){return new Promise((_0x560de0,_0x56c377)=>{const _0xe0e6df=a33_0x5bb8;try{_0x2703a0['log'](_0xe0e6df(0x239));const _0xbc031c=[];let _0x58cbad=Promise[_0xe0e6df(0x202)]();_0x4a4293[_0xe0e6df(0x23e)](_0x13f64f=>{const _0x26779b=_0xe0e6df;_0x58cbad=_0x58cbad[_0x26779b(0x1e4)](()=>getPrefilledJSON(_0x355303,_0x13f64f,_0x2703a0))['then'](_0x42a628=>{const _0x31896f=_0x26779b;_0xbc031c[_0x31896f(0x243)](_0x42a628),_0x2703a0[_0x31896f(0x217)](_0x31896f(0x1e6)+_0xbc031c[_0x31896f(0x223)]+_0x31896f(0x235)+_0x4a4293[_0x31896f(0x223)]);});}),_0x58cbad['then'](()=>{const _0x580003=_0xe0e6df;_0x2703a0['log'](_0x580003(0x215)),_0x560de0(_0xbc031c);})[_0xe0e6df(0x222)](_0x4afc04=>{const _0x13cbf7=_0xe0e6df;_0x2703a0[_0x13cbf7(0x217)](_0x13cbf7(0x219)+_0x4afc04),_0x56c377(_0x4afc04);});}catch(_0x9e5022){_0x2703a0[_0xe0e6df(0x217)](_0xe0e6df(0x219)+_0x9e5022),_0x56c377(_0x9e5022);}});}function getPrefilledJSON(_0x39430f,_0x483169,_0x341605){return new Promise((_0x19486b,_0x465e73)=>{const _0x346835=a33_0x5bb8;try{const _0x990065={'sClassName':_0x346835(0x1ec),'sType':_0x483169[_0x346835(0x1f9)],'sSubType':_0x483169[_0x346835(0x237)],'sLang':_0x483169['vlocity_cmt__Language__c']};_0x39430f['apex'][_0x346835(0x210)]('/vlocity_cmt/v1/GenericInvoke/',_0x990065,(_0x43da9d,_0x225b0f)=>{const _0x4372a8=_0x346835;_0x43da9d?(_0x341605[_0x4372a8(0x217)](_0x4372a8(0x241)+_0x43da9d),_0x465e73(_0x43da9d)):_0x19486b(JSON[_0x4372a8(0x22f)](_0x225b0f));});}catch(_0x3251c9){_0x465e73(_0x3251c9),_0x341605['log']('Error\x20Get\x20Prefilled\x20JSON\x20'+_0x3251c9);}});}function extractLwcDependencies(_0x3288b1,_0x368206){return new Promise((_0x2a39a8,_0x2734dd)=>{const _0x2426a4=a33_0x5bb8;try{_0x368206[_0x2426a4(0x217)](_0x2426a4(0x232));let _0x40f452=[];_0x3288b1['forEach'](_0xfa448d=>{const _0x4516e8=_0x2426a4;_0xfa448d[_0x4516e8(0x1e8)]&&_0xfa448d[_0x4516e8(0x1e8)][_0x4516e8(0x223)]>0x0&&_0xfa448d[_0x4516e8(0x1e8)]['forEach'](_0x54c790=>{const _0x4363f1=_0x4516e8;_0x54c790[_0x4363f1(0x1e8)]&&_0x54c790[_0x4363f1(0x1e8)]['length']>0x0&&_0x54c790[_0x4363f1(0x1e8)][_0x4363f1(0x23e)](_0x3e2b0a=>{const _0x2b7325=_0x4363f1;_0x3e2b0a[_0x2b7325(0x21a)][0x0][_0x2b7325(0x205)]===_0x2b7325(0x204)&&_0x40f452[_0x2b7325(0x243)](_0x3e2b0a[_0x2b7325(0x21a)][0x0]['propSetMap'][_0x2b7325(0x203)]);});});if(_0xfa448d[_0x4516e8(0x229)]&&_0xfa448d['propSetMap'][_0x4516e8(0x1e7)])for(const [_0x867fa1,_0x47bae7]of Object[_0x4516e8(0x220)](_0xfa448d[_0x4516e8(0x229)][_0x4516e8(0x1e7)])){_0x40f452['push'](_0x47bae7);}_0xfa448d['children']&&_0xfa448d[_0x4516e8(0x1e8)]['length']>0x0&&_0xfa448d[_0x4516e8(0x1e8)][_0x4516e8(0x23e)](_0x336e01=>{const _0x584843=_0x4516e8;_0x336e01[_0x584843(0x229)]&&_0x336e01[_0x584843(0x229)][_0x584843(0x22b)]&&_0x40f452['push'](_0x336e01['propSetMap'][_0x584843(0x22b)]),_0x336e01[_0x584843(0x1e8)]&&_0x336e01[_0x584843(0x1e8)]['length']>0x0&&_0x336e01['children'][_0x584843(0x23e)](_0x210a2c=>{const _0x2beee1=_0x584843;_0x210a2c['eleArray'][0x0][_0x2beee1(0x229)]&&_0x210a2c['eleArray'][0x0][_0x2beee1(0x229)][_0x2beee1(0x22b)]&&_0x40f452[_0x2beee1(0x243)](_0x210a2c[_0x2beee1(0x21a)][0x0][_0x2beee1(0x229)]['lwcComponentOverride']);});});}),_0x368206[_0x2426a4(0x217)](_0x2426a4(0x21e)),_0x2a39a8(_0x40f452);}catch(_0x249659){_0x368206[_0x2426a4(0x217)](_0x2426a4(0x234)+_0x249659),_0x2734dd(_0x249659);}});}module[a33_0x28d2d2(0x21d)]={'query':query,'getDependencyList':getDependencyList,'extractLwcDependencies':extractLwcDependencies,'fetchOmniOutContentList':fetchOmniOutContentList,'createLwcFiles':createLwcFiles,'sendComponents':sendComponents,'completeDeployment':completeDeployment};