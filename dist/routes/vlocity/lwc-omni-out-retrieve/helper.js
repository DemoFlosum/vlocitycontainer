const a33_0x361ab8=a33_0xd4ae;(function(_0x54bab0,_0x331d9f){const _0x4155ff=a33_0xd4ae,_0x5917d3=_0x54bab0();while(!![]){try{const _0x4346f8=parseInt(_0x4155ff(0x227))/0x1+parseInt(_0x4155ff(0x218))/0x2*(parseInt(_0x4155ff(0x1fa))/0x3)+parseInt(_0x4155ff(0x225))/0x4*(-parseInt(_0x4155ff(0x229))/0x5)+-parseInt(_0x4155ff(0x21a))/0x6*(parseInt(_0x4155ff(0x212))/0x7)+-parseInt(_0x4155ff(0x1ff))/0x8*(-parseInt(_0x4155ff(0x1f9))/0x9)+parseInt(_0x4155ff(0x247))/0xa+-parseInt(_0x4155ff(0x1ef))/0xb;if(_0x4346f8===_0x331d9f)break;else _0x5917d3['push'](_0x5917d3['shift']());}catch(_0x151112){_0x5917d3['push'](_0x5917d3['shift']());}}}(a33_0x58b4,0x6a607));const path=require(a33_0x361ab8(0x220)),fs=require('fs'),fse=require(a33_0x361ab8(0x245)),AdmZip=require(a33_0x361ab8(0x1f1)),constants=require('../../../constants'),http=require(a33_0x361ab8(0x210));function query(_0x4ff41b,_0x362284,_0x456378){return new Promise((_0xf2d3fe,_0xad5f3)=>{const _0x5b41aa=a33_0xd4ae;try{_0x456378[_0x5b41aa(0x250)](_0x5b41aa(0x206)),_0x4ff41b['query'](_0x362284,(_0x2f0199,_0x483894)=>{const _0x47d8d1=_0x5b41aa;_0x2f0199?(_0x456378[_0x47d8d1(0x250)](_0x47d8d1(0x243)+_0x2f0199),_0xad5f3(_0x2f0199)):(_0x456378[_0x47d8d1(0x250)](_0x47d8d1(0x240)),_0xf2d3fe(_0x483894[_0x47d8d1(0x24f)][_0x47d8d1(0x203)](_0x123076=>_0x123076[_0x47d8d1(0x20e)]&&_0x123076['vlocity_cmt__SubType__c']&&_0x123076[_0x47d8d1(0x214)])[_0x47d8d1(0x213)](({vlocity_cmt__Type__c:_0x5629a4,vlocity_cmt__SubType__c:_0xebe623,vlocity_cmt__Language__c:_0x5cc49b})=>{return''+_0x5629a4+_0xebe623+_0x5cc49b;})));});}catch(_0x130300){_0xad5f3(_0x130300),_0x456378[_0x5b41aa(0x250)](_0x5b41aa(0x243)+_0x130300);}});}function fetchOmniOutContentList(_0x5e4079,_0x2711aa,_0x10053c){return new Promise((_0x4a69b2,_0x5e0aec)=>{const _0x1b4330=a33_0xd4ae;try{_0x10053c[_0x1b4330(0x250)](_0x1b4330(0x207));const _0x43a7ab=[];let _0x3803a9=0x1,_0x44f720=Promise['resolve']();_0x2711aa['forEach'](_0x41e83a=>{const _0x24e3a2=_0x1b4330;_0x44f720=_0x44f720[_0x24e3a2(0x1fd)](()=>fetchOmniOutContent(_0x5e4079,_0x41e83a))['then'](_0x22e978=>{const _0xda5684=_0x24e3a2;_0x22e978&&_0x22e978['compositeResponse']&&_0x22e978[_0xda5684(0x1f7)][_0xda5684(0x223)]===0x2&&(_0x22e978[_0xda5684(0x1f7)][0x0][_0xda5684(0x1f5)]===0xc8&&_0x43a7ab[_0xda5684(0x204)]({'lwcComponentList':_0x22e978['compositeResponse'][0x1][_0xda5684(0x22e)]['records'],'name':_0x22e978[_0xda5684(0x1f7)][0x0]['body'][_0xda5684(0x24f)][0x0][_0xda5684(0x231)]})),_0x10053c[_0xda5684(0x250)](_0xda5684(0x222)+_0x3803a9++ +',\x20retrieved\x20'+_0x43a7ab[_0xda5684(0x223)]+_0xda5684(0x20c)+_0x2711aa['length']);});}),_0x44f720[_0x1b4330(0x1fd)](()=>{const _0x201532=_0x1b4330;_0x10053c[_0x201532(0x250)]('End\x20Fetch\x20OmniOut\x20Content\x20List\x20'),_0x4a69b2(_0x43a7ab);})[_0x1b4330(0x221)](_0x5ebac8=>{const _0x57dea9=_0x1b4330;_0x10053c[_0x57dea9(0x250)]('Error\x20Fetch\x20OmniOut\x20Content\x20List\x20'+_0x5ebac8),_0x5e0aec(_0x5ebac8);});}catch(_0x5d6b38){_0x5e0aec(_0x5d6b38),_0x10053c[_0x1b4330(0x250)](_0x1b4330(0x1ee)+_0x5d6b38);}});}function fetchOmniOutContent(_0x1f0419,_0x38caf6){const _0x76030f=a33_0x361ab8;_0x38caf6=_0x38caf6['replace']('-','')[_0x76030f(0x23d)](_0x76030f(0x238),'');const _0xfe03f9={'allOrNone':!![],'compositeRequest':[{'method':_0x76030f(0x202),'referenceId':_0x76030f(0x226),'url':_0x76030f(0x236)+_0x38caf6+'\x27'},{'method':'GET','referenceId':'bundleResources','url':_0x76030f(0x23f)}]},_0x1938e6=_0x1f0419[_0x76030f(0x23c)],_0x4418f1={'method':'POST','url':_0x1938e6+_0x76030f(0x232),'body':JSON['stringify'](_0xfe03f9),'headers':{'Content-Type':'application/json'}};return _0x1f0419[_0x76030f(0x235)](_0x4418f1);}function createLwcFiles(_0x577ac0,_0x58cfc7,_0x28fb12,_0x29cb80){return new Promise((_0x5b61f6,_0x2c1783)=>{const _0x53ffa6=a33_0xd4ae;try{_0x29cb80[_0x53ffa6(0x250)](_0x53ffa6(0x21f));let _0x5aad8e=[],_0x442425=[],_0x2b8bdf=0x0,_0x4dc70c=new AdmZip();_0x58cfc7[_0x53ffa6(0x249)](_0x18095a=>{const _0x350a8c=_0x53ffa6;_0x442425['push']({'apiName':_0x18095a['name'],'componentType':_0x350a8c(0x22b),'label':'lwc/'+_0x18095a[_0x350a8c(0x24c)]}),_0x18095a[_0x350a8c(0x1f6)][_0x350a8c(0x249)](_0x1d0d38=>{const _0x427d22=_0x350a8c;_0x1d0d38['Source']!==_0x427d22(0x241)&&(_0x2b8bdf+=_0x1d0d38[_0x427d22(0x242)]['length'],_0x2b8bdf<constants[_0x427d22(0x1fe)]?_0x4dc70c['addFile'](''+_0x1d0d38[_0x427d22(0x244)],Buffer['from'](_0x1d0d38[_0x427d22(0x242)][_0x427d22(0x23d)](new RegExp(_0x427d22(0x1f4),'g'),'c'))):(_0x5aad8e[_0x427d22(0x204)]({'snapshotId':_0x28fb12,'typeList':[{'type':_0x427d22(0x22b),'zip':_0x4dc70c[_0x427d22(0x1f0)]()[_0x427d22(0x20a)](_0x427d22(0x23a)),'componentList':_0x442425}]}),_0x442425=[],_0x2b8bdf=0x0,_0x4dc70c=new AdmZip()));}),delete _0x18095a[_0x350a8c(0x1f6)];}),_0x442425[_0x53ffa6(0x223)]&&_0x5aad8e[_0x53ffa6(0x204)]({'snapshotId':_0x28fb12,'typeList':[{'type':'LightningComponentBundle','zip':_0x4dc70c[_0x53ffa6(0x1f0)]()['toString'](_0x53ffa6(0x23a)),'componentList':_0x442425}]}),_0x29cb80[_0x53ffa6(0x250)]('End\x20Create\x20Lwc\x20Files'),_0x5b61f6(_0x5aad8e);}catch(_0x2bbdb5){_0x29cb80[_0x53ffa6(0x250)](_0x53ffa6(0x217)+_0x2bbdb5),_0x2c1783(_0x2bbdb5);}});}function a33_0x58b4(){const _0x33ad33=['Start\x20Update\x20Attachment\x20Log','1524PAMpBS','Custom\x20Lightning\x20Web\x20Component','Error\x20Get\x20Prefilled\x20JSON\x20','Error\x20Update\x20Attachment\x20Log\x20','exports','Start\x20Create\x20Lwc\x20Files','path','catch','Process\x20Fetch\x20OmniOut\x20Content,\x20processed\x20','length','parse','4hhhxIQ','bundleInfo','832825iCSiWL','propSetMap','3062915TeGFtS','entries','LightningComponentBundle','eleArray','Error\x20Send\x20Components\x20','body','METHOD_TYPE_ADD_COMPONENTS_TO_SNAPSHOT','End\x20Get\x20Dependency\x20List\x20','DeveloperName','/services/data/v50.0/tooling/composite','post','Start\x20Send\x20Components','request','/services/data/v48.0/tooling/query?q=SELECT+Id,DeveloperName,Description+FROM+LightningComponentBundle+WHERE+DeveloperName=\x27','/vlocity_cmt/v1/GenericInvoke/','vlocity_cmt__','Error\x20Get\x20Dependency\x20List\x20','base64','Start\x20Update\x20Snapshot','instanceUrl','replace','\x20from\x20','/services/data/v48.0/tooling/query?q=SELECT+Id,FilePath,Format,Source+FROM+LightningComponentResource+WHERE+LightningComponentBundleId=\x27@{bundleInfo.records[0].Id}\x27','End\x20Query','(hidden)','Source','Error\x20Query\x20','FilePath','fs-extra','callUpdateAttachmentLog','4534900gPUucJ','elementTypeToLwcTemplateMapping','forEach','Vlocity\x20BuildJSONWithPrefill','callUpdateLog','name','Process\x20Get\x20Dependency,\x20processed\x20','Is_Error__c','records','log','Error\x20Fetch\x20OmniOut\x20Content\x20List\x20','8352267vXzPLe','toBuffer','adm-zip','Error\x20Extract\x20LWC\x20Dependencies\x20','stringify','vlocity_cmt','httpStatusCode','lwcComponentList','compositeResponse','Error\x20getPrefilledJSON\x20','2520279xPJHRc','54573mlvHBH','resolve','Is_Completed__c','then','MAX_SIZE_UNZIP_ATTACHMENT','8ArYClS','type','vlocity_cmt__SubType__c','GET','filter','push','lwcComponentOverride','Start\x20Query','Start\x20Fetch\x20OmniOut\x20Content\x20List\x20','apex','End\x20Send\x20Components','toString','getAttachmentBody',',\x20all\x20','children','vlocity_cmt__Type__c','Start\x20Extract\x20LWC\x20Dependencies','../../../services/http','lwcName','15911oEHxyn','map','vlocity_cmt__Language__c','Error\x20Update\x20Snapshot','/services/apexrest/','Error\x20Create\x20Lwc\x20Files\x20','90YBjAdd'];a33_0x58b4=function(){return _0x33ad33;};return a33_0x58b4();}function sendComponents(_0xd3875,_0xd88383,_0x3d59bf,_0x1127a4,_0x3244c9){return new Promise((_0x583c91,_0x56df3a)=>{const _0x1bd29b=a33_0xd4ae;try{_0x3244c9['log'](_0x1bd29b(0x234));let _0xa7ca21=Promise[_0x1bd29b(0x1fb)]();_0x1127a4[_0x1bd29b(0x249)](_0xe5ab1c=>{const _0x3de0ca=_0x1bd29b;_0xa7ca21=_0xa7ca21[_0x3de0ca(0x1fd)](()=>callSentComponents(_0xd3875,_0xd88383,_0x3d59bf,_0xe5ab1c));}),_0xa7ca21['then'](()=>{const _0x207f7d=_0x1bd29b;_0x3244c9[_0x207f7d(0x250)](_0x207f7d(0x209)),_0x583c91();})[_0x1bd29b(0x221)](_0x2958af=>{const _0xada414=_0x1bd29b;_0x3244c9['log'](_0xada414(0x22d)+_0x2958af),_0x56df3a(_0x2958af);});}catch(_0x3b286c){_0x3244c9[_0x1bd29b(0x250)](_0x1bd29b(0x22d)+_0x3b286c),_0x56df3a(_0x3b286c);}});}function a33_0xd4ae(_0x27d48e,_0x375978){const _0x58b404=a33_0x58b4();return a33_0xd4ae=function(_0xd4ae19,_0x5a8592){_0xd4ae19=_0xd4ae19-0x1ee;let _0xde690c=_0x58b404[_0xd4ae19];return _0xde690c;},a33_0xd4ae(_0x27d48e,_0x375978);}function callSentComponents(_0x4af6b7,_0x4a85c2,_0x29fe7d,_0x5e7dbc){return new Promise((_0x25596d,_0x538c7f)=>{const _0x299442=a33_0xd4ae;try{const _0x2da88f={'methodType':constants[_0x299442(0x22f)],'body':JSON['stringify'](_0x5e7dbc)};_0x29fe7d=_0x29fe7d?_0x29fe7d[_0x299442(0x23d)]('__','')+'/':'';const _0x3c136d=_0x4af6b7+_0x299442(0x216)+_0x29fe7d[_0x299442(0x23d)]('__','')+'unlocked-packages';http[_0x299442(0x233)](_0x3c136d,_0x4a85c2,_0x29fe7d[_0x299442(0x23d)]('__',''),JSON[_0x299442(0x1f3)](_0x2da88f))[_0x299442(0x1fd)](()=>{_0x25596d();})[_0x299442(0x221)](_0x538c7f);}catch(_0x5e9492){_0x538c7f(_0x5e9492);}});}function completeDeployment(_0x19c288,_0x591ac2,_0x46f1ac,_0x3c49cf,_0x4e25c4,_0x45c5d1,_0x5141f7,_0x2016ff,_0x56b984=![]){return new Promise((_0x3045fc,_0x5be619)=>{const _0x2c64e8=a33_0xd4ae;try{Promise['resolve']()['then'](()=>updateAttachmentLog(_0x19c288,_0x591ac2,_0x45c5d1,_0x2016ff,_0x56b984,!![]))['then'](_0x461204=>{const _0x538836=a33_0xd4ae;return _0x56b984=_0x461204,http[_0x538836(0x24b)](_0x591ac2,_0x4e25c4,_0x46f1ac,_0x5141f7,_0x2016ff,_0x461204);})[_0x2c64e8(0x1fd)](()=>callUpdateSnapshot(_0x591ac2,_0x3c49cf,_0x46f1ac,_0x56b984,_0x2016ff));}catch(_0x769063){_0x5be619(_0x769063);}});}function updateAttachmentLog(_0xf3bdc7,_0x52d65a,_0x4813ba,_0x436f5c,_0x43cb7b,_0x27f3a1=![]){return new Promise(_0x2b5d86=>{const _0x13b11e=a33_0xd4ae;try{_0x436f5c['log'](_0x13b11e(0x219)),Promise[_0x13b11e(0x1fb)]()[_0x13b11e(0x1fd)](()=>http[_0x13b11e(0x20b)](_0x52d65a,_0x4813ba,_0x436f5c))['then'](_0x23fb9b=>{const _0x4d4c74=_0x13b11e;return http[_0x4d4c74(0x246)](_0x52d65a,_0x4813ba,_0x23fb9b,_0x436f5c,_0x43cb7b);})[_0x13b11e(0x1fd)](()=>_0x2b5d86(_0x43cb7b))[_0x13b11e(0x221)](()=>_0x2b5d86(_0x43cb7b));}catch(_0x5a76a7){_0x436f5c[_0x13b11e(0x250)](_0x13b11e(0x21d)+_0x5a76a7),_0x2b5d86(_0x43cb7b);}});}function callUpdateSnapshot(_0x5c7369,_0x3e1910,_0x25a7ff,_0x47bc55,_0x24a94f){return new Promise((_0x16da0b,_0x12adf5)=>{const _0x40a5ba=a33_0xd4ae;try{_0x24a94f[_0x40a5ba(0x250)](_0x40a5ba(0x23b));const _0x466d73={'Id':_0x3e1910,[_0x25a7ff+_0x40a5ba(0x1fc)]:!![],[_0x25a7ff+_0x40a5ba(0x24e)]:_0x47bc55};_0x5c7369['sobject'](_0x25a7ff+'Snapshot__c')['update'](_0x466d73)[_0x40a5ba(0x1fd)](()=>{const _0x26dde2=_0x40a5ba;_0x24a94f[_0x26dde2(0x250)]('End\x20Update\x20Snapshot'),_0x16da0b();})[_0x40a5ba(0x221)](_0x190516=>{const _0x27bffb=_0x40a5ba;_0x24a94f[_0x27bffb(0x250)](_0x27bffb(0x215)),_0x12adf5(_0x190516);});}catch(_0x519ca5){_0x24a94f[_0x40a5ba(0x250)](_0x40a5ba(0x215)),_0x12adf5(_0x519ca5);}});}function getDependencyList(_0x58a146,_0x43f4f2,_0x33e7a5){return new Promise((_0x5a6034,_0x2a7a04)=>{const _0x21cfe2=a33_0xd4ae;try{_0x33e7a5['log']('Start\x20Get\x20Dependency\x20List\x20');const _0x331db6=[];let _0x6c2e2a=Promise['resolve']();_0x43f4f2['forEach'](_0x4aa62b=>{const _0x1aba56=a33_0xd4ae;_0x6c2e2a=_0x6c2e2a['then'](()=>getPrefilledJSON(_0x58a146,_0x4aa62b,_0x33e7a5))[_0x1aba56(0x1fd)](_0x21e4ec=>{const _0x4baeb7=_0x1aba56;_0x331db6[_0x4baeb7(0x204)](_0x21e4ec),_0x33e7a5[_0x4baeb7(0x250)](_0x4baeb7(0x24d)+_0x331db6[_0x4baeb7(0x223)]+_0x4baeb7(0x23e)+_0x43f4f2[_0x4baeb7(0x223)]);});}),_0x6c2e2a[_0x21cfe2(0x1fd)](()=>{const _0x422629=_0x21cfe2;_0x33e7a5[_0x422629(0x250)](_0x422629(0x230)),_0x5a6034(_0x331db6);})[_0x21cfe2(0x221)](_0x28bdfb=>{const _0x59ce67=_0x21cfe2;_0x33e7a5['log'](_0x59ce67(0x239)+_0x28bdfb),_0x2a7a04(_0x28bdfb);});}catch(_0x5c85e4){_0x33e7a5[_0x21cfe2(0x250)](_0x21cfe2(0x239)+_0x5c85e4),_0x2a7a04(_0x5c85e4);}});}function getPrefilledJSON(_0x46af16,_0x27cd50,_0x484477){return new Promise((_0x100fb5,_0x3cc242)=>{const _0x4f3af9=a33_0xd4ae;try{const _0x12e9e6={'sClassName':_0x4f3af9(0x24a),'sType':_0x27cd50[_0x4f3af9(0x20e)],'sSubType':_0x27cd50[_0x4f3af9(0x201)],'sLang':_0x27cd50[_0x4f3af9(0x214)]};_0x46af16[_0x4f3af9(0x208)][_0x4f3af9(0x233)](_0x4f3af9(0x237),_0x12e9e6,(_0x4ef92b,_0x29d0a2)=>{const _0x4d36d4=_0x4f3af9;_0x4ef92b?(_0x484477[_0x4d36d4(0x250)](_0x4d36d4(0x1f8)+_0x4ef92b),_0x3cc242(_0x4ef92b)):_0x100fb5(JSON[_0x4d36d4(0x224)](_0x29d0a2));});}catch(_0x2a63a3){_0x3cc242(_0x2a63a3),_0x484477[_0x4f3af9(0x250)](_0x4f3af9(0x21c)+_0x2a63a3);}});}function extractLwcDependencies(_0x1efc4c,_0xba36c8){return new Promise((_0x5c5ad4,_0x5255f5)=>{const _0x4ecd53=a33_0xd4ae;try{_0xba36c8['log'](_0x4ecd53(0x20f));let _0x51ec67=[];_0x1efc4c[_0x4ecd53(0x249)](_0x2093a2=>{const _0x25e868=_0x4ecd53;_0x2093a2[_0x25e868(0x20d)]&&_0x2093a2[_0x25e868(0x20d)][_0x25e868(0x223)]>0x0&&_0x2093a2[_0x25e868(0x20d)][_0x25e868(0x249)](_0xea3e5e=>{const _0x2d14ed=_0x25e868;_0xea3e5e[_0x2d14ed(0x20d)]&&_0xea3e5e[_0x2d14ed(0x20d)][_0x2d14ed(0x223)]>0x0&&_0xea3e5e['children']['forEach'](_0x48e9ed=>{const _0x476fdd=_0x2d14ed;_0x48e9ed[_0x476fdd(0x22c)][0x0][_0x476fdd(0x200)]===_0x476fdd(0x21b)&&_0x51ec67[_0x476fdd(0x204)](_0x48e9ed['eleArray'][0x0][_0x476fdd(0x228)][_0x476fdd(0x211)]);});});if(_0x2093a2[_0x25e868(0x228)]&&_0x2093a2[_0x25e868(0x228)][_0x25e868(0x248)])for(const [_0x59a963,_0x1fa039]of Object[_0x25e868(0x22a)](_0x2093a2['propSetMap'][_0x25e868(0x248)])){_0x51ec67['push'](_0x1fa039);}_0x2093a2['children']&&_0x2093a2['children'][_0x25e868(0x223)]>0x0&&_0x2093a2[_0x25e868(0x20d)][_0x25e868(0x249)](_0x5b8051=>{const _0x3db098=_0x25e868;_0x5b8051[_0x3db098(0x228)]&&_0x5b8051[_0x3db098(0x228)][_0x3db098(0x205)]&&_0x51ec67['push'](_0x5b8051['propSetMap'][_0x3db098(0x205)]),_0x5b8051[_0x3db098(0x20d)]&&_0x5b8051['children'][_0x3db098(0x223)]>0x0&&_0x5b8051[_0x3db098(0x20d)]['forEach'](_0x17dd16=>{const _0x575a8f=_0x3db098;_0x17dd16[_0x575a8f(0x22c)][0x0][_0x575a8f(0x228)]&&_0x17dd16[_0x575a8f(0x22c)][0x0][_0x575a8f(0x228)][_0x575a8f(0x205)]&&_0x51ec67['push'](_0x17dd16[_0x575a8f(0x22c)][0x0][_0x575a8f(0x228)][_0x575a8f(0x205)]);});});}),_0xba36c8[_0x4ecd53(0x250)]('End\x20Extract\x20LWC\x20Dependencies'),_0x5c5ad4(_0x51ec67);}catch(_0x7f8317){_0xba36c8[_0x4ecd53(0x250)](_0x4ecd53(0x1f2)+_0x7f8317),_0x5255f5(_0x7f8317);}});}module[a33_0x361ab8(0x21e)]={'query':query,'getDependencyList':getDependencyList,'extractLwcDependencies':extractLwcDependencies,'fetchOmniOutContentList':fetchOmniOutContentList,'createLwcFiles':createLwcFiles,'sendComponents':sendComponents,'completeDeployment':completeDeployment};