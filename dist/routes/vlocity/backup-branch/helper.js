const a13_0x221d8b=a13_0x1e56;(function(_0x351455,_0x5f3328){const _0x644676=a13_0x1e56,_0x2d1029=_0x351455();while(!![]){try{const _0x2ecad7=parseInt(_0x644676(0x1f5))/0x1+-parseInt(_0x644676(0x1f7))/0x2+-parseInt(_0x644676(0x217))/0x3*(parseInt(_0x644676(0x219))/0x4)+parseInt(_0x644676(0x236))/0x5+parseInt(_0x644676(0x221))/0x6+parseInt(_0x644676(0x1f8))/0x7*(parseInt(_0x644676(0x216))/0x8)+-parseInt(_0x644676(0x214))/0x9;if(_0x2ecad7===_0x5f3328)break;else _0x2d1029['push'](_0x2d1029['shift']());}catch(_0x254d8f){_0x2d1029['push'](_0x2d1029['shift']());}}}(a13_0x8e8c,0x202ea));const fs=require('fs'),AdmZip=require(a13_0x221d8b(0x223)),childProcess=require('../../../services/child-process'),constants=require('../../../constants'),http=require('../../../services/http');function createJobFileRollback(_0x236779,_0x4106d0,_0x5c01d8,_0x2cc915){return new Promise((_0x3ceecd,_0x33ac25)=>{const _0x302506=a13_0x1e56;try{_0x2cc915[_0x302506(0x228)](_0x302506(0x20d));let _0x926013='projectPath:\x20./'+constants[_0x302506(0x212)]+_0x302506(0x215);Object[_0x302506(0x20f)](_0x4106d0)[_0x302506(0x1fa)](_0xa29a14=>{const _0x59324e=_0x302506;_0x4106d0[_0xa29a14][_0x59324e(0x1fa)](_0xe46fb5=>{const _0x3ff295=_0x59324e;constants['DATA_PACK_TYPES_QUERIES_MAP'][_0xa29a14][_0x3ff295(0x1fa)](_0x1c7b7e=>{const _0xb423a4=_0x3ff295;_0x926013+=_0xb423a4(0x210)+_0xa29a14+'\x0a',_0x926013+=_0xb423a4(0x226)+_0x1c7b7e+_0xb423a4(0x1fd)+_0xe46fb5+_0xb423a4(0x218);});});}),fs[_0x302506(0x1f4)](_0x236779+'/'+constants['JOB_FILE_NAME'],_0x926013),_0x2cc915[_0x302506(0x228)](_0x302506(0x229)),_0x3ceecd();}catch(_0x36e498){_0x2cc915[_0x302506(0x228)](_0x302506(0x230)),_0x33ac25(_0x36e498);}});}function retrieveData(_0x38f882,_0x5618af,_0x1ddc71,_0x40efe2){return new Promise((_0x20b192,_0x98d301)=>{const _0xa5d6cf=a13_0x1e56;try{_0x40efe2['log'](_0xa5d6cf(0x227));const _0x26a8f0='vlocity',_0x5900be=['-sf.accessToken',''+_0x1ddc71,_0xa5d6cf(0x211),''+_0x5618af,'-job',''+constants[_0xa5d6cf(0x207)],_0xa5d6cf(0x233),_0xa5d6cf(0x234),'0',_0xa5d6cf(0x22a)];_0x40efe2[_0xa5d6cf(0x228)](_0x5900be[_0xa5d6cf(0x231)](0x2)['join']('\x20'));const _0x198422={'cwd':''+_0x38f882,'maxBuffer':0x400*0x1f4};childProcess[_0xa5d6cf(0x209)](_0x26a8f0,_0x5900be,_0x40efe2,_0x198422)[_0xa5d6cf(0x21f)](_0x8e210b=>{const _0x2ca4b1=_0xa5d6cf;_0x40efe2[_0x2ca4b1(0x228)](_0x2ca4b1(0x22b)),_0x20b192(_0x8e210b);})[_0xa5d6cf(0x21d)](_0x4290f3=>{const _0x5a4ff3=_0xa5d6cf;_0x40efe2[_0x5a4ff3(0x228)](_0x5a4ff3(0x1f9)+_0x4290f3),_0x98d301(_0x4290f3);});}catch(_0x2fe939){_0x98d301(_0x2fe939);}});}function prepareDataForDeploy(_0x5a88a5,_0x1a8911){return new Promise((_0x472741,_0x3b0bb9)=>{const _0x171cf=a13_0x1e56;try{_0x1a8911[_0x171cf(0x228)](_0x171cf(0x22d));const _0x1dbc26=_0x5a88a5+'/'+constants[_0x171cf(0x21a)];let _0x371a13=new AdmZip();const _0x4857ad=fs['readdirSync'](_0x1dbc26,{'withFileTypes':!![]}),_0x2b377a=[];_0x4857ad[_0x171cf(0x1fa)](_0x21926e=>{const _0x525864=_0x171cf;if(_0x21926e[_0x525864(0x1fe)]()){const _0x243e04=_0x371a13[_0x525864(0x1fb)]()[_0x525864(0x22e)]('base64');_0x243e04['length']>0x1e8480&&(_0x2b377a[_0x525864(0x200)](_0x243e04),_0x371a13=new AdmZip()),_0x371a13['addLocalFolder'](_0x1dbc26+'/'+_0x21926e[_0x525864(0x208)],_0x21926e[_0x525864(0x208)]);}}),_0x2b377a['push'](_0x371a13[_0x171cf(0x1fb)]()[_0x171cf(0x22e)](_0x171cf(0x20a))),_0x1a8911[_0x171cf(0x228)](_0x171cf(0x203)),_0x472741(_0x2b377a);}catch(_0x4ae1e1){_0x1a8911[_0x171cf(0x228)](_0x171cf(0x204)),_0x3b0bb9(_0x4ae1e1);}});}function deployData(_0x4450b1,_0x4b1d03,_0x2659e5,_0x476c21,_0x14d78b,_0x18f555,_0x41f569,_0x1a63bc,_0x504e16){return new Promise((_0x275286,_0xe5699e)=>{const _0x32b424=a13_0x1e56;try{_0x504e16[_0x32b424(0x228)](_0x32b424(0x201)),_0x2659e5=_0x2659e5&&_0x2659e5[_0x32b424(0x206)]?_0x2659e5['replace']('__','')+'/':'';let _0x434ef2={'zipBuffer':'','pipelineId':_0x18f555,'logId':_0x476c21,'branchId':_0x1a63bc,'pipelineNumber':_0x41f569};const _0x1ebc65=_0x4450b1+'/services/apexrest/'+_0x2659e5+_0x32b424(0x225);let _0x4a5167=Promise[_0x32b424(0x21c)](),_0x618f41=0x1;_0x14d78b[_0x32b424(0x1fa)](_0x4df84c=>{const _0x292b20=_0x32b424;_0x434ef2[_0x292b20(0x220)]=_0x4df84c,_0x434ef2[_0x292b20(0x1f6)]=_0x618f41===_0x14d78b[_0x292b20(0x206)];const _0xd3681c={'methodType':constants[_0x292b20(0x22c)],'body':JSON[_0x292b20(0x21e)](_0x434ef2)};_0x4a5167=_0x4a5167['then'](()=>postDeploy(_0x1ebc65,_0x4b1d03,_0x2659e5,_0xd3681c)),_0x618f41++;}),_0x4a5167[_0x32b424(0x21f)](()=>{const _0x5a7555=_0x32b424;_0x504e16[_0x5a7555(0x228)](_0x5a7555(0x1ff)),_0x275286();})[_0x32b424(0x21d)](_0x31f815=>{const _0x147377=_0x32b424;_0x504e16[_0x147377(0x228)](_0x147377(0x20b)),_0xe5699e(_0x31f815);});}catch(_0x1a8ee9){_0x504e16[_0x32b424(0x228)](_0x32b424(0x20b)),_0xe5699e(_0x1a8ee9);}});}function handleNoComponents(_0x5129e8,_0x3db903,_0x595df9,_0x314b0e,_0x2f22b9,_0x38be0f,_0xcb21b2,_0x180590){return new Promise((_0x4d9e68,_0x1f9758)=>{const _0x236bbf=a13_0x1e56;try{_0x180590[_0x236bbf(0x228)](_0x236bbf(0x202)),_0x595df9=_0x595df9&&_0x595df9[_0x236bbf(0x206)]?_0x595df9[_0x236bbf(0x22f)]('__','')+'/':'';let _0x12482d={'message':_0x236bbf(0x224),'pipelineId':_0x2f22b9,'logId':_0x314b0e,'branchId':_0xcb21b2,'pipelineNumber':_0x38be0f,'isStartDeploy':!![]};const _0x292f8b=_0x5129e8+_0x236bbf(0x20c)+_0x595df9+_0x236bbf(0x225),_0x6ec617={'methodType':constants[_0x236bbf(0x1fc)],'body':JSON[_0x236bbf(0x21e)](_0x12482d)};postDeploy(_0x292f8b,_0x3db903,_0x595df9,_0x6ec617)[_0x236bbf(0x21f)](()=>{const _0x3cc44c=_0x236bbf;_0x180590[_0x3cc44c(0x228)](_0x3cc44c(0x20e)),_0x4d9e68();})[_0x236bbf(0x21d)](_0x3bc745=>{const _0x5c04ea=_0x236bbf;_0x1f9758(_0x3bc745),_0x180590[_0x5c04ea(0x228)](_0x5c04ea(0x21b));});}catch(_0x1dd08a){_0x180590[_0x236bbf(0x228)]('Error\x20Update\x20Log.\x20No\x20Components\x20to\x20Backup.'),_0x1f9758(_0x1dd08a);}});}function postDeploy(_0x389cd0,_0x370b48,_0x2042ec,_0x28c7e4){return new Promise((_0x567745,_0x216a33)=>{const _0x5d9f56=a13_0x1e56;try{http[_0x5d9f56(0x235)](_0x389cd0,_0x370b48,_0x2042ec,_0x28c7e4)['then'](_0xd80e30=>{_0x567745(_0xd80e30);})[_0x5d9f56(0x21d)](_0x57e3ac=>{const _0x51574b=_0x5d9f56;console[_0x51574b(0x228)](_0x57e3ac),_0x216a33(_0x57e3ac);});}catch(_0x2de1ff){_0x216a33(_0x2de1ff);}});}function a13_0x8e8c(){const _0x5185a3=['post','385220lUDGof','appendFileSync','152308yzlKJR','isStartDeploy','57210kLlFPp','2324TJtItb','Error\x20Retrieve\x20Data\x20','forEach','toBuffer','METHOD_BACKUP_LOG_ERROR','\x20where\x20Name\x20LIKE\x20\x27%','isDirectory','End\x20Deploy\x20Data','push','Start\x20Deploy\x20Data','Start\x20Update\x20Log.\x20No\x20Components\x20to\x20Backup.','End\x20Prepare\x20Data\x20For\x20Deploy','Error\x20Prepare\x20Data\x20For\x20Deploy','METHOD_NEXT_VLOCITY_CONTINUE_DEPLOY_STEP','length','JOB_FILE_NAME','name','callChildProcess','base64','Error\x20Deploy\x20Data','/services/apexrest/','Start\x20Create\x20Job\x20File','End\x20Update\x20Log.\x20No\x20Components\x20to\x20Backup.','keys','\x20\x20-\x20VlocityDataPackType:\x20','-sf.instanceUrl','UNZIP_CATALOG_NAME','End\x20Continue\x20Vlocity\x20Pipeline\x20Deploy','2208384mHfxKJ','\x0aqueries:\x0a','4960gEBrWm','19599LxOAyW','%\x27\x0a','88tYZTuH','SOURCE_FOLDER','Error\x20Update\x20Log.\x20No\x20Components\x20to\x20Backup.\x0a','resolve','catch','stringify','then','zipBuffer','685998Rlsunu','Error\x20Continue\x20Vlocity\x20Pipeline\x20Deploy','adm-zip','Components\x20not\x20found!','unlocked-packages','\x20\x20\x20\x20query:\x20Select\x20Id\x20from\x20','Start\x20Retrieve\x20Data','log','End\x20Create\x20Job\x20File','packExport','End\x20Retrieve\x20Data','METHOD_BACKUP_LOG','Start\x20Prepare\x20Data\x20For\x20Deploy','toString','replace','Error\x20Create\x20Job\x20File','slice','exports','-autoRetryErrors','-maxDepth'];a13_0x8e8c=function(){return _0x5185a3;};return a13_0x8e8c();}function callContinuePipelineVlocityDeploy(_0x1a98d9,_0x2ee062,_0x420bdc,_0x541dff,_0x201943,_0x3a3e7b,_0x5878a8,_0x19a3cf,_0x1287f0){return new Promise((_0x314b4a,_0x2ef131)=>{const _0xe11f25=a13_0x1e56;try{_0x420bdc=_0x420bdc&&_0x420bdc[_0xe11f25(0x206)]?_0x420bdc[_0xe11f25(0x22f)]('__','')+'/':'',_0x1287f0[_0xe11f25(0x228)]('Start\x20Continue\x20Vlocity\x20Pipeline\x20Deploy');const _0x8fd1ac={'pipelineId':_0x541dff,'pipelineNumber':_0x201943,'logId':_0x19a3cf,'branchId':_0x5878a8,'pipelineKey':_0x3a3e7b},_0x2bc625=_0x1a98d9+_0xe11f25(0x20c)+_0x420bdc+_0xe11f25(0x225),_0x1ee729={'methodType':constants[_0xe11f25(0x205)],'body':JSON[_0xe11f25(0x21e)](_0x8fd1ac)};http[_0xe11f25(0x235)](_0x2bc625,_0x2ee062,_0x420bdc,_0x1ee729)[_0xe11f25(0x21f)](_0x464972=>{const _0x402a8f=_0xe11f25;_0x1287f0['log'](_0x402a8f(0x213)),_0x314b4a(_0x464972);})[_0xe11f25(0x21d)](_0x1fc2cc=>{const _0x27e62b=_0xe11f25;_0x1287f0[_0x27e62b(0x228)](_0x27e62b(0x222)),_0x2ef131(_0x1fc2cc);});}catch(_0x5e5b14){_0x2ef131(_0x5e5b14);}});}function a13_0x1e56(_0x8f811a,_0x2b705c){const _0x8e8c68=a13_0x8e8c();return a13_0x1e56=function(_0x1e5668,_0x1f75fe){_0x1e5668=_0x1e5668-0x1f4;let _0x108aa8=_0x8e8c68[_0x1e5668];return _0x108aa8;},a13_0x1e56(_0x8f811a,_0x2b705c);}module[a13_0x221d8b(0x232)]={'createJobFileRollback':createJobFileRollback,'retrieveData':retrieveData,'prepareDataForDeploy':prepareDataForDeploy,'deployData':deployData,'handleNoComponents':handleNoComponents,'callContinuePipelineVlocityDeploy':callContinuePipelineVlocityDeploy};